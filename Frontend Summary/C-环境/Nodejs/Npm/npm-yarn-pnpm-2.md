## **npm - Node 包管理器**

npm 是 Node.js 的默认包管理器，以其广泛的包注册表和与 Node.js 生态系统的无缝集成而闻名。它被创建来简化在 Node.js 项目中安装、管理和共享代码依赖的过程。npm 提供了一个庞大的仓库，拥有超过两百万个包，使其成为JavaScript 开发人员的综合生态系统，也是全球最大的软件注册表。

以下是对 npm 的更详细介绍：

### **优势：**

**1.庞大的包仓库**：开发人员喜爱 npm 的无与伦比的包注册表，拥有超过两百万个包，涵盖了广泛的功能和用例。开发人员可以访问丰富的开源库和模块生态系统，从而利用现有解决方案并加速开发。

**2.Node.js的默认选择**：npm 随 Node.js 安装一起提供，使其成为 Node.js 项目的默认包管理器。其与 Node.js 生态系统的无缝集成简化了依赖管理，并确保与 Node.js 运行时的兼容性。

**3.成熟的生态系统**：npm 拥有成熟且良好建立的生态系统，具有强大的基础设施和社区支持。它已经使用了多年，并经过持续改进，从而成为管理项目依赖项的稳定可靠的工具。

**4.全面的命令行界面**：npm 提供了全面的命令行界面（CLI），具有广泛的命令和选项，用于管理包、脚本和配置。开发人员可以使用 npm 直观的CLI轻松执行安装、更新、发布和脚本等任务。

**5.语义化版本控制**：npm 遵循语义化版本控制（SemVer）规则，允许开发人员准确地指定依赖项的版本范围。这确保在更新包时的兼容性和可预测性，最大程度地减少了项目中发生破坏性变化的风险。

**6.自定义脚本**：npm 允许开发人员在 “ package.json ” 文件中定义自定义脚本，可以使用 npm run 命令执行。这个特性使得各种开发任务的自动化变得可能，如构建、测试和部署，从而简化了开发工作流程。

**7.与npm注册表的集成**：npm 与 npm 注册表无缝集成，后者是一个集中式仓库，开发人员可以在其中发布和发现包。这种集中式基础设施促进了JavaScript社区内的合作和代码共享，为生态系统的增长和创新做出了贡献。

总的来说，npm 提供了一个强大而功能丰富的包管理解决方案，满足了构建Node.js 应用程序的开发人员的需求。其庞大的包仓库、成熟的生态系统、全面的 CLI 和社区支持使其成为全球 JavaScript 开发人员的首选。

### **缺点：**

**1.性能问题**：npm 有时会出现性能问题，特别是在具有许多依赖项的大型项目中。一些开发人员发现 Yarn 和 pnpm 更快。安装时间慢和资源消耗高可能会影响开发人员的生产力和构建时间。

**2.版本控制复杂性**：使用 npm 管理包版本和依赖冲突可能具有挑战性，特别是在具有复杂依赖树的项目中。解决版本冲突并确保包之间的兼容性可能需要手动干预和仔细监督。

**3.依赖膨胀**：npm 默认的本地安装行为可能导致依赖膨胀，项目随时间累积了不必要的依赖关系。这可能会增加项目的大小和复杂性，潜在地影响性能和维护工作。

**4.安全问题**：npm 包并不免受安全漏洞的影响，依赖第三方代码会给项目带来潜在风险。虽然 npm 提供了用于审核包和检测漏洞的工具，但开发人员必须保持警惕，并积极主动地解决安全问题。

**5.对集中式注册表的依赖**：npm 依赖于集中式注册表进行包分发和发现，这引入了单一故障点和潜在的网络瓶颈。npm 注册表的中断或故障可能会干扰开发工作流程和依赖管理流程。

**6.有限的离线支持**：尽管 npm 通过本地缓存提供了一些离线安装支持，但其离线能力不及一些其他包管理器（如 Yarn ）那么强大。在网络连接有限或间歇性的环境中工作的开发人员可能会在依赖 npm 时遇到困难。

总的来说，尽管 npm 是一个功能强大且广泛采用的包管理器，但开发人员应该意识到它的局限性，并考虑替代解决方案或最佳实践，以减轻依赖管理和项目维护中可能遇到的挑战。

## **Yarn**

Yarn 是由 Facebook 开发的 Node.js 包管理器。它被创建来解决 npm 存在的一些限制和性能问题，并专注于性能、可靠性和确定性依赖解析。让我们来探索它的特点：

### **优势：**

**1.改进的性能**：与 npm 相比，Yarn 以更快的安装时间和更高效的依赖解析而闻名。它通过并行安装包和缓存机制来实现这一点，减少了管理依赖所需的时间和资源。

**2.确定性依赖解析**：Yarn 通过生成一个锁定文件（yarn.lock）来确保确定性依赖解析，该文件记录了项目中使用的依赖的确切版本。这有助于防止依赖冲突，并确保在不同的开发环境中保持一致性。

**3.离线支持**：Yarn 提供了强大的离线安装支持，适用于网络连接有限或间歇性的环境。它会在本地缓存包，允许开发人员在没有依赖于活动互联网连接的情况下安装依赖。

**4.直观的 CLI**：Yarn 提供了一个直观的命令行界面（ CLI ），具有清晰简洁的命令，用于管理包和运行脚本。其 CLI 设计用户友好，易于使用，简化了开发工作流程。

**5.改进的错误处理**：Yarn 提供了详细的错误消息和诊断信息，使开发人员更容易地排查和解决与包安装或依赖管理相关的问题。

**6.向后兼容性**：Yarn 与 npm 注册表和现有的 npm 工作流程保持兼容，使开发人员能够在不中断项目的情况下从 npm 迁移到 Yarn。

总的来说，Yarn 是一个强大而高效的 Node.js 包管理器，提供了性能改进、确定性依赖解析、离线支持和直观的 CLI。它已在 Node.js 社区中获得了广泛的应用，并被广泛用于小型和大型项目中。

### **缺点：**

**1.兼容性问题**：虽然 Yarn 的目标是与 npm 兼容，但两个包管理器之间仍可能存在偶尔的兼容性问题或行为差异。这有时可能导致意外行为或在 npm 和 Yarn 之间迁移项目时遇到困难。

**2.资源消耗**：Yarn 的缓存机制和并行安装过程可能会消耗大量系统资源，特别是在具有大型依赖树的项目中。这可能会影响开发环境的性能，特别是在资源有限或较老的硬件系统上。

**3.社区分化**：尽管 Yarn 在 Node.js 社区中获得了广泛的应用，但其生态系统和社区支持可能仍然比 npm 的规模和范围小。这可能导致与 npm 相比，较少的第三方插件、集成和社区驱动的倡议。

**4.锁文件漂移的可能性**：Yarn 生成一个锁定文件（yarn.lock）以确保确定性依赖解析。然而，如果开发人员在不更新锁定文件的情况下手动修改依赖项或更新包，可能会导致锁定文件漂移，即锁定文件与项目中实际安装的依赖项不同步。

**5.配置选项有限**：与 npm 相比，Yarn 的配置选项更有限，后者提供了更精细的控制，包括包安装、注册表设置和其他依赖管理方面的设置。开发人员可能会发现 Yarn 中缺少某些在 npm 中可用的自定义选项。

**6.维护开销**：虽然 Yarn 提供了诸如性能改进和依赖解析等好处，但它还引入了额外的维护开销，涉及管理 Yarn 特定的配置、锁定文件和依赖项。这可能增加项目维护和版本控制的复杂性。

总的来说，虽然 Yarn 解决了 npm 的许多缺点，并在性能和可靠性方面取得了显著的改进，但开发人员在决定是否采用 Yarn 时，必须考虑到权衡和潜在的缺点。

## **pnpm**

pnpm，全称为“高性能 npm ”，是用于 Node.js 应用程序的包管理器。与传统的包管理器如 npm 和 Yarn 不同，pnpm 采用了一种独特的依赖管理方式，强调效率、磁盘空间优化和安装速度。

### **优势：**

pnpm 的关键特性包括：

**1.共享依赖项**：pnpm 采用共享依赖项模型，在磁盘上的单个位置存储跨项目的公共依赖项。这种方式通过避免重复复制依赖项，最小化了磁盘空间的使用，从而节省了大量存储资源。

**2.高效安装**：通过利用共享依赖项和高效的缓存机制，pnpm 提供比传统的包管理器更快的安装时间。它可以大幅缩短安装依赖项所需的时间，特别是在具有大型依赖树的项目中。

**3.确定性依赖解析**：与 Yarn 类似，pnpm 通过生成一个锁定文件（pnpm-lock.yaml）来确保确定性依赖解析，该文件记录了项目中使用的依赖的确切版本。这有助于防止依赖冲突，并确保在不同的开发环境中保持一致性。

**4.减少网络带宽使用**：pnpm 通过在项目之间共享软件包下载来优化网络带宽使用。当多个项目需要相同的依赖项时，pnpm 仅在第一次获取软件包，并在所有项目之间共享它，从而减少了通过网络传输的数据量。

**5.提高缓存效率**：pnpm 的缓存机制设计得非常高效，减少了重新下载软件包的需要，提高了安装速度。它维护着一个中心化的软件包和依赖项缓存，使安装速度更快，并最小化了冗余下载。

**6.命令行界面（CLI）**：pnpm 提供了一个直观的 CLI，包括用于安装、更新和管理软件包的命令。其 CLI 设计用户友好，易于使用，具有清晰简洁的语法，用于执行常见任务。

**7.与 npm 的兼容性**：pnpm 保持与 npm 注册表和现有的 npm 工作流程兼容，使开发人员能够在不中断项目的情况下从 npm 迁移到 pnpm。它可以从 npm 注册表安装软件包，并与现有的 npm 软件包和配置无缝配合。

总的来说，pnpm 在磁盘空间优化、安装速度和网络带宽使用方面提供了显著的优势，使其成为寻求简化 Node.js 项目中依赖管理的开发人员的理想选择。其共享依赖项模型和高效的缓存机制使其特别适用于具有大型依赖树和资源约束的项目。

### **缺点：**

**1.学习曲线**：从像 npm 和 Yarn 这样的传统包管理器切换到 pnpm 可能需要开发人员学习 pnpm 特定的新命令、工作流程和概念。虽然 pnpm 的 CLI 很直观，但仍然涉及学习曲线，特别是对于不熟悉其共享依赖模型和缓存机制的开发人员。

**2.兼容性问题**：尽管 pnpm 的目标是与 npm 和 Yarn 兼容，但两者之间仍可能存在偶尔的兼容性问题或行为差异。这有时可能导致意外行为或在迁移项目时遇到困难。

**3.资源消耗**：虽然 pnpm 的共享依赖模型减少了磁盘空间的使用，但它仍可能消耗大量系统资源，特别是在具有大型依赖树的项目中。缓存依赖项和管理共享包可能需要额外的内存和处理能力，影响开发环境的性能。

**4.锁文件处理**：pnpm 生成一个锁定文件（pnpm-lock.yaml）以确保确定性依赖解析。然而，管理锁定文件并确保其在不同环境中的一致性可能是具有挑战性的。开发人员必须小心避免锁定文件漂移，即锁定文件与项目中实际安装的依赖项不同步。

**5.社区支持**：尽管 pnpm 在 Node.js 社区中获得了采用，但其生态系统和社区支持可能仍然比 npm 和 Yarn 小而不完整。这可能导致较少的第三方插件、集成、文档资源和教程可用，以及社区驱动的倡议，限制了对 pnpm 用户的可用资源和支持。

总的来说，尽管 pnpm 在磁盘空间优化和安装速度方面具有显著优势，但开发人员在决定是否采用 pnpm 时应仔细权衡权衡，并考虑潜在的缺点。

## **项目的结构**

**npm**：使用 npm install 命令时，将创建 package-lock.json 文件，并生成 node_modules 文件夹。您可以手动在根目录下放置一个 .npmrc 配置文件。

![图片](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1713001030147.png)

**Yarn**：类似地，Yarn 生成了 yarn.lock 文件和 node_modules 文件夹。您还可以通过 .yarnrc 文件配置您的 Yarn；Yarn 也会识别 .npmrc 文件。

![1713001038956](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1713001038956.png)

npm 和 Yarn 的一个问题是，为了满足多个依赖关系，包被复制了多次。pnpm 解决了这个问题，而不是将依赖树展平。每个包的依赖项都被分组在一个 node_modules 文件夹中，并使用符号链接将依赖项组合在一起，因此目录树是扁平的。

相比之下，pnpm 偏离了这一点，不会创建一个扁平的依赖树。使用 pnpm i 安装依赖项时，会生成一个 package.json 文件以及一个 node_modules 文件夹。然而，由于 pnpm 采用了内容可寻址存储的方法，node_modules 目录的结构与 npm 和 Yarn 大不相同。

![图片](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1713001051291.png)

## 比较

- 安全性：Pnpm 和 Yarn 一样，有一个特殊文件，其中包含所有已安装包的校验和。这确保了在执行它们的代码之前对所有已安装包的完整性进行验证。至于 npm，由于 npm 处理恶意包的方式，曾经出现过一些安全漏洞，直接影响了许多项目。
- 磁盘空间利用率：pnpm 使用内容可寻址文件系统来存储磁盘上的包和依赖项。这意味着相同的包不会被复制。即使是相同包的不同版本，pnpm 也会智能地最大化代码的重用。例如，如果一个包的第一个版本由500个文件组成，而第二个版本只增加了一个文件，pnpm 不会复制第一个版本的500个文件以创建第二个版本。相反，它会与现有的500个文件建立硬链接，并只写入新文件。相比之下，npm 会复制第一个版本的500个文件以创建第二个版本。这种区别在大型 monorepo 项目中变得显著，在这些项目中一个包被许多其他包使用，使用 pnpm 可能会节省大量磁盘空间。
- 锁定文件：Yarn 生成一个 yarn.lock 文件，以确保所有团队成员使用相同的包版本。这有助于防止“在我的机器上运行”问题。与 Yarn 类似，pnpm 使用一个 pnpm-lock.yaml 文件来确保一致的依赖版本。npm 可能会在 package-lock.json 中呈现不一致性，这可能会让开发人员感到困扰，并引发问题。

## **从 npm/Yarn 迁移到 pnpm**

如果您的项目使用 npm 或 yarn，则迁移到 pnpm 不会很困难。下面是 npm、yarn 和 pnpm 命令的比较。

![1713001109277](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1713001109277.png)