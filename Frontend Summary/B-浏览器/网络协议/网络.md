# ç½‘ç»œå¤§å¸ˆè¯¾

# 1 ç½‘ç»œåˆ†å±‚æ¨¡å‹å’Œåº”ç”¨åè®®

## 1.1 åˆ†å±‚æ¨¡å‹

### 1.1.1 åˆ†å±‚çš„æ„ä¹‰

å½“é‡åˆ°ä¸€ä¸ªå¤æ‚é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å±‚çš„æ€æƒ³æŠŠé—®é¢˜ç®€å•åŒ–

æ¯”å¦‚ï¼Œä½ æœ‰åŠæ¯82å¹´çš„å¯ä¹ï¼Œæƒ³åˆ†äº«ç»™ä½ çš„æœ‹å‹ç‹å¯Œè´µï¼Œä½†ä½ ä»¬å·²ç»10å¹´æ²¡æœ‰è”ç³»äº†ã€‚è¦å®Œæˆè¿™ä»¶äº‹ï¼Œä½ å¯èƒ½è¦è€ƒè™‘ï¼š

- æˆ‘ç”¨ä»€ä¹ˆè£…å¯ä¹ï¼Ÿ

  å¯èƒ½çš„æ–¹æ¡ˆï¼šå¡‘æ–™ç“¶ã€ç»ç’ƒç“¶ã€ç…¤æ°”ç½

- æ€ä¹ˆä¿è¯å¯ä¹å§‹ç»ˆå¤„äºä½æ¸©ï¼Ÿ

  å¯èƒ½çš„æ–¹æ¡ˆï¼šä¿æ¸©æ¯ã€å°å†°ç®±ã€å†°ç›’

- å¦‚ä½•ä¿è¯å¯ä¹ä¸è¢«è¿è¾“çš„äººå·å–ï¼Ÿ

  å¯èƒ½çš„æ–¹æ¡ˆï¼šå°æ¡ã€åœ¨ä¸Šé¢å†™ã€Œæ¯’è¯ã€

- å¦‚ä½•è·å–ç‹å¯Œè´µçš„åœ°å€ï¼Ÿ

  å¯èƒ½çš„æ–¹æ¡ˆï¼šæŠ¥æ¡ˆå¤±è¸ªã€è”ç³»ç§äººä¾¦æ¢ã€è”ç³»ç‰©æµå…¬å¸çš„æœ‹å‹

- å¦‚ä½•è¿è¾“ï¼Ÿ

  å¯èƒ½çš„æ–¹æ¡ˆï¼šè‡ªè¡Œè½¦ã€æ±½è½¦ã€ç«è½¦ã€é«˜é“ã€é£æœºã€ç«ç®­

è¿™å°±å½¢æˆäº†ä¸€ä¸ªåˆ†å±‚ç»“æ„

![1720346193030](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346193030.png)

ä»å¸¸ç†å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

- æ¯å±‚ç›¸å¯¹ç‹¬ç«‹ï¼Œåªéœ€è§£å†³è‡ªå·±çš„é—®é¢˜
- æ¯å±‚æ— é¡»è€ƒè™‘ä¸Šå±‚çš„äº¤ä»˜ï¼Œä»…éœ€æŠŠè‡ªå·±çš„ç»“æœäº¤ç»™ä¸‹å±‚å³å¯
- æ¯å±‚æœ‰å¤šç§æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼Œé€‰æ‹©ä¸åŒçš„æ–¹æ¡ˆä¸ä¼šå¯¹ä¸Šä¸‹å±‚é€ æˆå½±å“
- æ¯ä¸€å±‚ä¼šåœ¨ä¸Šä¸€å±‚çš„åŸºç¡€ä¸Šå¢åŠ ä¸€äº›é¢å¤–ä¿¡æ¯

### 1.1.2 äº”å±‚ç½‘ç»œæ¨¡å‹

ç½‘ç»œè¦è§£å†³çš„é—®é¢˜æ˜¯ï¼š**ä¸¤ä¸ªç¨‹åºä¹‹é—´å¦‚ä½•äº¤æ¢æ•°æ®**ã€‚

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„é—®é¢˜ï¼Œå› ä¸ºä¸¤ä¸ªç¨‹åºæœ‰å¯èƒ½å‡ºç°åœ¨ä¸åŒçš„è®¾å¤‡ä¸Šã€‚

é¢å¯¹å¤æ‚çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å±‚çš„æ–¹å¼æ¥ç®€åŒ–ã€‚

ç»è¿‡ä¸æ–­çš„æ¼”åŒ–ï¼Œç½‘ç»œæœ€ç»ˆå½¢æˆäº†äº”å±‚æ¨¡å‹ï¼š

![1720346215448](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346215448.png)

### 1.1.3 æ•°æ®çš„ä¼ è¾“

![1720346234246](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346234246.png)

### 1.1.4 å››å±‚ã€äº”å±‚ã€ä¸ƒå±‚

![1720346251410](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346251410.png)

## 1.2 åº”ç”¨å±‚åè®®

### 1.2.1 URL

URLï¼ˆuniform resource locatorï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ç”¨äºå®šä½ç½‘ç»œæœåŠ¡

![1720346262581](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346262581.png)

URLæ˜¯ä¸€ä¸ªå›ºå®šæ ¼å¼çš„å­—ç¬¦ä¸²

![1720346278024](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346278024.png)

å®ƒè¡¨è¾¾äº†ï¼š

ä»ç½‘ç»œä¸­==å“ªå°è®¡ç®—æœºï¼ˆdomainï¼‰==ä¸­çš„==å“ªä¸ªç¨‹åºï¼ˆportï¼‰==å¯»æ‰¾==å“ªä¸ªæœåŠ¡ï¼ˆpathï¼‰==ï¼Œå¹¶æ³¨æ˜äº†è·å–æœåŠ¡çš„==å…·ä½“ç»†èŠ‚ï¼ˆqueryï¼‰==ï¼Œä»¥åŠè¦ç”¨ä»€ä¹ˆæ ·çš„==åè®®é€šä¿¡ï¼ˆschemaï¼‰==

è¿™é‡Œé¢åŒ…å«äº†ä¸€äº›ç»†èŠ‚ï¼š

- å½“åè®®æ˜¯`http`ç«¯å£ä¸º`80`æ—¶ï¼Œç«¯å£å¯ä»¥çœç•¥
- å½“åè®®æ˜¯`https`ç«¯å£ä¸º`443`æ—¶ï¼Œç«¯å£å¯ä»¥çœç•¥
- `schema`ã€`domain`ã€`path`æ˜¯å¿…å¡«çš„ï¼Œå…¶ä»–çš„æ ¹æ®å…·ä½“çš„è¦æ±‚å¡«å†™

### 1.2.2 HTTP

è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyper Text Transfer Protocolï¼Œ*HTTP*ï¼‰æ˜¯ä¸€ä¸ªå¹¿æ³›è¿ç”¨äºäº’è”ç½‘çš„åº”ç”¨å±‚åè®®ã€‚

99%çš„æƒ…å†µä¸‹ï¼Œå‰ç«¯å¼€å‘è€…æ¥è§¦çš„éƒ½æ˜¯HTTPåè®®ã€‚

è¯¥åè®®è§„å®šäº†ä¸¤ä¸ªæ–¹é¢çš„å†…å®¹ï¼š

- **ä¼ é€’æ¶ˆæ¯çš„æ¨¡å¼**
- **ä¼ é€’æ¶ˆæ¯çš„æ ¼å¼**

#### 1.2.2.1 ä¼ é€’æ¶ˆæ¯çš„æ¨¡å¼

![1720346306538](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346306538.png)

HTTPä½¿ç”¨äº†ä¸€ç§æä¸ºç®€å•çš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼Œã€Œè¯·æ±‚-å“åº”ã€æ¨¡å¼

å‘èµ·è¯·æ±‚çš„ç§°ä¹‹ä¸ºå®¢æˆ·ç«¯ï¼Œæ¥æ”¶è¯·æ±‚å¹¶å®Œæˆå“åº”çš„ç§°ä¹‹ä¸ºæœåŠ¡å™¨ã€‚

ã€Œè¯·æ±‚-å“åº”ã€å®Œæˆåï¼Œä¸€æ¬¡äº¤äº’ç»“æŸã€‚

#### 1.2.2.2 ä¼ é€’æ¶ˆæ¯çš„æ ¼å¼

![1720346332637](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346332637.png)

HTTPçš„æ¶ˆæ¯æ ¼å¼æ˜¯ä¸€ç§çº¯æ–‡æœ¬çš„æ ¼å¼ï¼Œæ–‡æœ¬åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

```
è¯·æ±‚è¡Œ
è¯·æ±‚å¤´

è¯·æ±‚ä½“
```

**å…·ä½“æ¯ä¸€éƒ¨åˆ†å†™ä»€ä¹ˆå†…å®¹ï¼Œè¦çœ‹å…·ä½“çš„æœåŠ¡è¦æ±‚**

#### 1.2.2.3 è¯•ä¸€è¯•

æœ‰éå¸¸å¤šçš„å·¥å…·å¯ä»¥å‘é€httpè¯·æ±‚ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªéå¸¸ç›´è§‚çš„å·¥å…·

1. å®‰è£…`vscode`æ’ä»¶`REST Clinet

![1720346362563](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346362563.png)

1. æ–°å»ºæ–‡ä»¶`xxx.http`

2. ç¼–å†™è¯·æ±‚æ–‡æœ¬

   ```
   POST /api/user/login HTTP/1.1
   Host: study.duyiedu.com
   Content-Type: application/json
   
   {
     "loginId":"admin",
     "loginPwd":"123123"
   }
   ```

3. å‘é€è¯·æ±‚

#### 1.2.2.4 ç†Ÿæ‚‰å…³é”®ä¿¡æ¯

##### 1.2.2.4.1 è¯·æ±‚æ–¹æ³•

è¯·æ±‚è¡Œä¸­çš„ç¬¬ä¸€ä¸ªå•è¯æ˜¯è¯·æ±‚æ–¹æ³•

**åœ¨HTTPåè®®ä¸­ï¼Œè¯·æ±‚æ–¹æ³•ä»…æœ‰è¯­ä¹‰çš„åŒºåˆ«**ï¼Œåªæ˜¯è¡¨è¾¾äº†è¿™æ¬¡è¯·æ±‚çš„ã€Œæ„¿æœ›ã€ã€‚

> å…³äºè¯·æ±‚æ–¹æ³•çš„åè®®åŸæ–‡è§ HTTP/1.1è§„èŒƒRFC7231-Chapter4
>
> ![1720346396708](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346396708.png)

æ¯”å¦‚`GET`è¡¨è¾¾äº†å®¢æˆ·ç«¯æƒ³è¦è·å–ä¸€äº›ä¸œè¥¿ï¼Œ`POST`è¡¨è¾¾äº†å®¢æˆ·ç«¯æƒ³è¦æäº¤ä¸€äº›ä¸œè¥¿

å¸¸è§çš„è¯·æ±‚æ–¹æ³•æœ‰ï¼š

- `GET`ï¼šè·å–
- `POST`ï¼šæäº¤
- `PUT`ï¼šä¿®æ”¹
- `DELETE`ï¼šåˆ é™¤

**å…·ä½“åœ¨å¼€å‘ä¸­åº”è¯¥é€‰æ‹©ä»€ä¹ˆè¯·æ±‚æ–¹æ³•ï¼Œä¸€å®šæ˜¯çœ‹æœåŠ¡æ–¹çš„è¦æ±‚**

é€šå¸¸æƒ…å†µä¸‹ï¼š

- è·å–æ•°æ®ä¸€èˆ¬ä½¿ç”¨`GET`
- æäº¤æ•°æ®ä¸€èˆ¬ä½¿ç”¨`POST`
- å„ç§é™æ€èµ„æºçš„è·å–ï¼Œä¸€èˆ¬ä½¿ç”¨`GET`

##### 1.2.2.4.2 è¯·æ±‚å¤´ - `Host`

```
Host`æ ‡æ³¨äº†`URL`åœ°å€ä¸­çš„`Domain + Port
```

ç¤ºä¾‹ï¼š

```
Host: study.duyiedu.com
```

##### 1.2.2.4.3 è¯·æ±‚å¤´ - `Content-Type`

`Content-Type`æ ‡æ³¨äº†é™„å¸¦çš„è¯·æ±‚ä½“æ˜¯ä»€ä¹ˆæ ¼å¼

æ¯”å¦‚ï¼Œè¯·æ±‚ä½“çš„æ•°æ®ä¸º`loginId:admin, loginPwd:123456`ï¼Œè¯·æ±‚ä½“å¯ä»¥ç”¨ä¸åŒçš„æ ¼å¼å‘å‡º

```
Content-Type: application/x-www-form-urlencoded

loginId=admin&loginPwd=123123
Content-Type: application/json

{ "loginId": "admin", "loginPwd": "123123" }
Content-Type: multipart/form-data; boundary=aaa

--aaa
Content-Disposition: form-data; name="loginId"

admin
--aaa
Content-Disposition: form-data; name="loginPwd"

123456
--aaa
Content-Disposition: form-data; name="avatar"; filename="small.jpg"
Content-Type: image/jpeg

æ–‡ä»¶çš„äºŒè¿›åˆ¶
--aaa--

```

##### 1.2.2.4.4 å“åº”ç 

å“åº”ç ï¼ˆçŠ¶æ€ç ã€æ¶ˆæ¯ç ï¼‰æ˜¯å“åº”è¡Œä¸­çš„ä¸€ä¸ªæ•°å­—ï¼Œåé¢å¾€å¾€è·Ÿä¸Šä¸€ä¸ªå¯¹åº”çš„å•è¯ï¼Œç”¨äºè¡¨è¾¾æœåŠ¡å™¨å¯¹è¿™ä¸ªå“åº”çš„æ•´ä½“ã€Œæ€åº¦ã€

å¸¸è§çš„å“åº”ç æœ‰ï¼š

![1720346433478](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346433478.png)

å¸¸è§çš„çŠ¶æ€ç æœ‰ï¼š

1. 200 OKï¼šä¸€åˆ‡æ­£å¸¸ã€‚

2. 301 Moved Permanentlyï¼šèµ„æºå·²è¢«æ°¸ä¹…é‡å®šå‘ã€‚

   `ä½ çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†ï¼Œä½†æ˜¯å‘¢ï¼Œä½ è¦çš„ä¸œè¥¿ä¸åœ¨è¿™ä¸ªåœ°å€äº†ï¼Œæˆ‘å·²ç»æ°¸è¿œçš„æŠŠå®ƒç§»åŠ¨åˆ°äº†ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œéº»çƒ¦ä½ å–è¯·æ±‚æ–°çš„åœ°å€ï¼Œåœ°å€æˆ‘æ”¾åˆ°äº†å“åº”å¤´çš„Locationä¸­äº†`

   > è¯•è¯•è¯·æ±‚ï¼šwww.douyutv.com

3. 302 Foundï¼šèµ„æºå·²è¢«ä¸´æ—¶é‡å®šå‘ã€‚

   `ä½ çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†ï¼Œä½†æ˜¯å‘¢ï¼Œä½ è¦çš„ä¸œè¥¿ä¸åœ¨è¿™ä¸ªåœ°å€äº†ï¼Œæˆ‘ä¸´æ—¶çš„æŠŠå®ƒç§»åŠ¨åˆ°äº†ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œéº»çƒ¦ä½ å–è¯·æ±‚æ–°çš„åœ°å€ï¼Œåœ°å€æˆ‘æ”¾åˆ°äº†è¯·æ±‚å¤´çš„Locationä¸­äº†`

4. 304 Not Modifiedï¼šæ–‡æ¡£å†…å®¹æœªè¢«ä¿®æ”¹ã€‚

   `ä½ çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†ï¼Œä½ è¦çš„ä¸œè¥¿è·Ÿä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰ä»»ä½•çš„å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘å°±ä¸ç»™ä½ ç»“æœäº†ï¼Œä½ è‡ªå·±å°±ç”¨ä»¥å‰çš„å§ã€‚å•¥ï¼Ÿä½ æ²¡æœ‰ç¼“å­˜ä»¥å‰çš„å†…å®¹ï¼Œå…³æˆ‘å•¥äº‹`

5. 400 Bad Requestï¼šè¯­ä¹‰æœ‰è¯¯ï¼Œå½“å‰è¯·æ±‚æ— æ³•è¢«æœåŠ¡å™¨ç†è§£ã€‚

   `ä½ ç»™æˆ‘å‘çš„æ˜¯ä¸ªå•¥å•Šï¼Œæˆ‘å¬éƒ½å¬ä¸æ‡‚`

6. 403 Forbiddenï¼šæœåŠ¡å™¨æ‹’ç»æ‰§è¡Œã€‚

   `ä½ çš„è¯·æ±‚æˆ‘å·²æ”¶åˆ°ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯ä¸ç»™ä½ ä¸œè¥¿`

7. 404 Not Foundï¼šèµ„æºä¸å­˜åœ¨ã€‚

   `ä½ çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†ï¼Œä½†æˆ‘æ²¡æœ‰ä½ è¦çš„ä¸œè¥¿`

8. 500 Internal Server Errorï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚

   `ä½ çš„è¯·æ±‚æˆ‘å·²æ”¶åˆ°ï¼Œä½†è¿™é“é¢˜æˆ‘ä¸ä¼šï¼Œè§£ä¸å‡ºæ¥ï¼Œå…ˆç¡äº†`

##### 1.2.2.4.5 å“åº”å¤´ - `Content-Type`

`Content-Type`æ ‡æ³¨äº†é™„å¸¦çš„å“åº”ä½“æ˜¯ä»€ä¹ˆæ ¼å¼

å¸¸è§çš„å€¼æœ‰ï¼š

1. `text/plain`: æ™®é€šçš„çº¯æ–‡æœ¬
2. `text/html`ï¼šhtmlæ–‡æ¡£
3. `text/javascript` æˆ– `application/javascript`ï¼šjsä»£ç 
4. `text/css`ï¼šcssä»£ç 
5. `image/jpeg`ï¼šjpgå›¾ç‰‡
6. `attachment`ï¼šé™„ä»¶
7. å…¶ä»–`MIME`ç±»å‹

## 1.3 æ€è€ƒ

æ ¹æ®è¿™èŠ‚è¯¾å­¦åˆ°çš„çŸ¥è¯†ï¼Œæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä¸ä½¿ç”¨æµè§ˆå™¨ï¼Œæ˜¯å¦èƒ½å¤Ÿå®Œæˆé¡µé¢æµè§ˆï¼Ÿ

# 2 æµè§ˆå™¨çš„é€šä¿¡èƒ½åŠ›

## 2.1 ç”¨æˆ·ä»£ç†

æµè§ˆå™¨å¯ä»¥ä»£æ›¿ç”¨æˆ·å®Œæˆhttpè¯·æ±‚ï¼Œä»£æ›¿ç”¨æˆ·è§£æå“åº”ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸ºï¼š

**ç”¨æˆ·ä»£ç† user agent**

åœ¨ç½‘ç»œå±‚é¢ï¼Œå¯¹äºå‰ç«¯å¼€å‘è€…ï¼Œå¿…é¡»è¦çŸ¥é“æµè§ˆå™¨æ‹¥æœ‰çš„ä¸¤å¤§æ ¸å¿ƒèƒ½åŠ›ï¼š

- è‡ªåŠ¨å‘å‡ºè¯·æ±‚çš„èƒ½åŠ›
- è‡ªåŠ¨è§£æå“åº”çš„èƒ½åŠ›

### 2.1.1 è‡ªåŠ¨å‘å‡ºè¯·æ±‚çš„èƒ½åŠ›

å½“ä¸€äº›äº‹æƒ…å‘ç”Ÿçš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šä»£æ›¿ç”¨æˆ·è‡ªåŠ¨å‘å‡ºhttpè¯·æ±‚ï¼Œå¸¸è§çš„åŒ…æ‹¬ï¼š

1. **ç”¨æˆ·åœ¨åœ°å€æ è¾“å…¥äº†ä¸€ä¸ªurlåœ°å€ï¼Œå¹¶æŒ‰ä¸‹äº†å›è½¦**

   æµè§ˆå™¨ä¼šè‡ªåŠ¨è§£æURLï¼Œå¹¶å‘å‡ºä¸€ä¸ª`GET`è¯·æ±‚ï¼ŒåŒæ—¶æŠ›å¼ƒå½“å‰é¡µé¢ã€‚

2. **å½“ç”¨æˆ·ç‚¹å‡»äº†é¡µé¢ä¸­çš„aå…ƒç´ **

   æµè§ˆå™¨ä¼šæ‹¿åˆ°aå…ƒç´ çš„hrefåœ°å€ï¼Œå¹¶å‘å‡ºä¸€ä¸ª`GET`è¯·æ±‚ï¼ŒåŒæ—¶æŠ›å¼ƒå½“å‰é¡µé¢ã€‚

3. **å½“ç”¨æˆ·ç‚¹å‡»äº†æäº¤æŒ‰é’®<button type="submit">...</button>**

   æµè§ˆå™¨ä¼šè·å–æŒ‰é’®æ‰€åœ¨çš„`<form>`å…ƒç´ ï¼Œæ‹¿åˆ°å®ƒçš„`action`å±æ€§åœ°å€ï¼ŒåŒæ—¶æ‹¿åˆ°å®ƒ`method`å±æ€§å€¼ï¼Œç„¶åæŠŠè¡¨å•ä¸­çš„æ•°æ®ç»„ç»‡åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå‘å‡º`æŒ‡å®šæ–¹æ³•`çš„è¯·æ±‚ï¼ŒåŒæ—¶æŠ›å¼ƒå½“å‰é¡µé¢ã€‚

   > è¿™ç§æ–¹å¼çš„æäº¤ç°åœ¨è¶Šæ¥è¶Šå°‘è§äº†

4. **å½“è§£æHTMLæ—¶é‡åˆ°äº†<link> <img> <script> <video> <audio>ç­‰å…ƒç´ **

   æµè§ˆå™¨ä¼šæ‹¿åˆ°å¯¹åº”çš„åœ°å€ï¼Œå‘å‡º`GET`è¯·æ±‚

5. **å½“ç”¨æˆ·ç‚¹å‡»äº†åˆ·æ–°**

   æµè§ˆå™¨ä¼šæ‹¿åˆ°å½“å‰é¡µé¢çš„åœ°å€ï¼Œä»¥åŠå½“å‰é¡µé¢çš„è¯·æ±‚æ–¹æ³•ï¼Œé‡æ–°å‘ä¸€æ¬¡è¯·æ±‚ï¼ŒåŒæ—¶æŠ›å¼ƒå½“å‰é¡µé¢ã€‚

> æµè§ˆå™¨åœ¨å‘å‡ºè¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨é™„å¸¦ä¸€äº›è¯·æ±‚å¤´

==é‡ç‚¹æ¥äº†==

ä»å¤è‡³ä»Šï¼Œæµè§ˆå™¨éƒ½æœ‰ä¸€ä¸ªçº¦å®šï¼š

**å½“å‘é€GETè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¸ä¼šé™„å¸¦è¯·æ±‚ä½“**

è¿™ä¸ªçº¦å®šæ·±åˆ»çš„å½±å“ç€åç»­çš„å‰åç«¯å„ç§åº”ç”¨ï¼Œç°åœ¨ï¼Œå‡ ä¹æ‰€æœ‰äººéƒ½åœ¨æ½œæ„è¯†ä¸­è®¤åŒäº†è¿™ä¸€ç‚¹ï¼Œæ— è®ºæ˜¯å‰ç«¯å¼€å‘äººå‘˜è¿˜æ˜¯åç«¯å¼€å‘äººå‘˜ã€‚

ç”±äºå‰åç«¯ç¨‹åºçš„é»˜è®¤è¡Œä¸ºï¼Œé€æ­¥é€ æˆäº†GETå’ŒPOSTçš„å„ç§å·®å¼‚ï¼š

1. æµè§ˆå™¨åœ¨å‘é€ GET è¯·æ±‚æ—¶ï¼Œä¸ä¼šé™„å¸¦è¯·æ±‚ä½“
2. GET è¯·æ±‚çš„ä¼ é€’ä¿¡æ¯é‡æœ‰é™ï¼Œé€‚åˆä¼ é€’å°‘é‡æ•°æ®ï¼›POST è¯·æ±‚çš„ä¼ é€’ä¿¡æ¯é‡æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œé€‚åˆä¼ è¾“å¤§é‡æ•°æ®ã€‚
3. GET è¯·æ±‚åªèƒ½ä¼ é€’ ASCII æ•°æ®ï¼Œé‡åˆ°é ASCII æ•°æ®éœ€è¦è¿›è¡Œç¼–ç ï¼›POST è¯·æ±‚æ²¡æœ‰é™åˆ¶
4. å¤§éƒ¨åˆ† GET è¯·æ±‚ä¼ é€’çš„æ•°æ®éƒ½é™„å¸¦åœ¨ path å‚æ•°ä¸­ï¼Œèƒ½å¤Ÿé€šè¿‡åˆ†äº«åœ°å€å®Œæ•´çš„é‡ç°é¡µé¢ï¼Œä½†åŒæ—¶ä¹Ÿæš´éœ²äº†æ•°æ®ï¼Œè‹¥æœ‰æ•æ„Ÿæ•°æ®ä¼ é€’ï¼Œä¸åº”è¯¥ä½¿ç”¨ GET è¯·æ±‚ï¼Œè‡³å°‘ä¸åº”è¯¥æ”¾åˆ° path ä¸­
5. POST ä¸ä¼šè¢«ä¿å­˜åˆ°æµè§ˆå™¨çš„å†å²è®°å½•ä¸­
6. åˆ·æ–°é¡µé¢æ—¶ï¼Œè‹¥å½“å‰çš„é¡µé¢æ˜¯é€šè¿‡ POST è¯·æ±‚å¾—åˆ°çš„ï¼Œåˆ™æµè§ˆå™¨ä¼šæç¤ºç”¨æˆ·æ˜¯å¦é‡æ–°æäº¤ã€‚è‹¥æ˜¯ GET è¯·æ±‚å¾—åˆ°çš„é¡µé¢åˆ™æ²¡æœ‰æç¤ºã€‚

### 2.1.2 è‡ªåŠ¨è§£æå“åº”çš„èƒ½åŠ›

æµè§ˆå™¨ä¸ä»…èƒ½å‘é€è¯·æ±‚ï¼Œè¿˜èƒ½å¤Ÿé’ˆå¯¹æœåŠ¡å™¨çš„å„ç§å“åº”ç»“æœåšå‡ºä¸åŒçš„è‡ªåŠ¨å¤„ç†

å¸¸è§çš„å¤„ç†æœ‰ï¼š

1. **è¯†åˆ«å“åº”ç **

   æµè§ˆå™¨èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å“åº”ç ï¼Œå½“å‡ºç°ä¸€äº›ç‰¹æ®Šçš„å“åº”ç æ—¶æµè§ˆå™¨ä¼šè‡ªåŠ¨å®Œæˆå¤„ç†ï¼Œæ¯”å¦‚`301ã€302`

2. **æ ¹æ®å“åº”ç»“æœåšä¸åŒçš„å¤„ç†**

   æµè§ˆå™¨èƒ½å¤Ÿè‡ªåŠ¨åˆ†æå“åº”å¤´ä¸­çš„`Content-Type`ï¼Œæ ¹æ®ä¸åŒçš„å€¼è¿›è¡Œä¸åŒå¤„ç†ï¼Œæ¯”å¦‚ï¼š

3. - `text/plain`: æ™®é€šçš„çº¯æ–‡æœ¬ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šå°†å“åº”ä½“åŸå°ä¸åŠ¨çš„æ˜¾ç¤ºåˆ°é¡µé¢ä¸Š

   - `text/html`ï¼šhtmlæ–‡æ¡£ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šå°†å“åº”ä½“ä½œä¸ºé¡µé¢è¿›è¡Œæ¸²æŸ“

   - `text/javascript`æˆ–`application/javascript`ï¼šjsä»£ç ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šä½¿ç”¨JSæ‰§è¡Œå¼•æ“å°†å®ƒè§£ææ‰§è¡Œ

   - `text/css`ï¼šcssä»£ç ï¼Œæµè§ˆå™¨ä¼šå°†å®ƒè§†ä¸ºæ ·å¼

   - `image/jpeg`ï¼šæµè§ˆå™¨ä¼šå°†å®ƒè§†ä¸ºjpgå›¾ç‰‡

   - `application/octet-stream`ï¼šäºŒè¿›åˆ¶æ•°æ®ï¼Œä¼šè§¦å‘æµè§ˆå™¨ä¸‹è½½åŠŸèƒ½

   - `attachment`ï¼šé™„ä»¶ï¼Œä¼šè§¦å‘ä¸‹è½½åŠŸèƒ½

     è¯¥å€¼å’Œå…¶ä»–å€¼ä¸åŒï¼Œåº”æ”¾åˆ°`Content-Disposition`å¤´ä¸­ã€‚

### 2.1.3 åŸºæœ¬æµç¨‹

> è®¿é—®ï¼šhttps://oss.duyiedu.com/test/index.html

![1720346527943](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346527943.png)

## 2.2 AJAX

> æµè§ˆå™¨æœ¬èº«å°±å…·å¤‡ç½‘ç»œé€šä¿¡çš„èƒ½åŠ›ï¼Œä½†åœ¨æ—©æœŸï¼Œæµè§ˆå™¨å¹¶æ²¡æœ‰æŠŠè¿™ä¸ªèƒ½åŠ›å¼€æ”¾ç»™JSã€‚
>
> æœ€æ—©æ˜¯å¾®è½¯åœ¨IEæµè§ˆå™¨ä¸­æŠŠè¿™ä¸€èƒ½åŠ›å‘JSå¼€æ”¾ï¼Œè®©JSå¯ä»¥åœ¨ä»£ç ä¸­å®ç°å‘é€è¯·æ±‚ï¼Œå¹¶ä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œè¿™é¡¹æŠ€æœ¯åœ¨2005å¹´è¢«æ­£å¼å‘½åä¸ºAJAXï¼ˆ**A**synchronous **J**avascript **A**nd **X**MLï¼‰

AJAX å°±æ˜¯æŒ‡åœ¨webåº”ç”¨ç¨‹åºä¸­å¼‚æ­¥å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚

å®ƒçš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼Œ`XMLHttpRequest ç®€ç§°XHR`å’Œ`Fetch`

ä»¥ä¸‹æ˜¯ä¸¤è€…çš„å¯¹æ¯”

| åŠŸèƒ½ç‚¹                   | XHR      | Fetch     |
| :----------------------- | :------- | :-------- |
| åŸºæœ¬çš„è¯·æ±‚èƒ½åŠ›           | âœ…        | âœ…         |
| åŸºæœ¬çš„è·å–å“åº”èƒ½åŠ›       | âœ…        | âœ…         |
| ç›‘æ§è¯·æ±‚è¿›åº¦             | âœ…        | âŒ         |
| ç›‘æ§å“åº”è¿›åº¦             | âœ…        | âœ…         |
| Service Workerä¸­æ˜¯å¦å¯ç”¨ | âŒ        | âœ…         |
| æ§åˆ¶cookieçš„æºå¸¦         | âŒ        | âœ…         |
| æ§åˆ¶é‡å®šå‘               | âŒ        | âœ…         |
| è¯·æ±‚å–æ¶ˆ                 | âœ…        | âœ…         |
| è‡ªå®šä¹‰referrer           | âŒ        | âœ…         |
| æµ                       | âŒ        | âœ…         |
| APIé£æ ¼                  | `Event`  | `Promise` |
| æ´»è·ƒåº¦                   | åœæ­¢æ›´æ–° | ä¸æ–­æ›´æ–°  |

## 2.3 å®æˆ˜

### 2.3.1 è¯·æ±‚å¹¶è·å–å“åº”æ•°æ®

è¯·æ±‚åœ°å€ï¼šhttps://study.duyiedu.com/api/herolist

è¯·æ±‚æ–¹æ³•ï¼šGET

å“åº”ç±»å‹ï¼šapplication/json

å“åº”ç»“æœï¼šç‹è€…è£è€€è‹±é›„æ•°æ®

### 2.3.2 ä¸Šä¼ æ–‡ä»¶å¹¶ç›‘æ§è¿›åº¦

#### 2.3.2.1 å‡†å¤‡å·¥ä½œï¼šå¯åŠ¨æœ¬åœ°æ–‡ä»¶ä¸Šä¼ æœåŠ¡å™¨

**å¦‚æœæ²¡æœ‰å®‰è£…node**

1. ä¸‹è½½å®‰è£…nodeï¼Œhttps://nodejs.org/zh-cn/

2. æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼Œè®¾ç½®æ·˜å®æº

   ```
   npm config set registry https://registry.npm.taobao.org
   ```

**å®‰è£…ä¾èµ–**

1. åœ¨å‘½ä»¤è¡Œè¿›å…¥`upload-server`ç›®å½•
2. è¿è¡Œ`npm i`

**å¯åŠ¨æœåŠ¡å™¨**

1. åœ¨å‘½ä»¤è¡Œè¿›å…¥`upload-server`ç›®å½•
2. è¿è¡Œ`npm start`

#### 2.3.2.2 ä¸Šä¼ æ¥å£

è¯·æ±‚è·¯å¾„ï¼š`/upload/single`

è¯·æ±‚æ–¹æ³•ï¼š`POST`

æ¶ˆæ¯æ ¼å¼ï¼š`multipart/form-data`

å­—æ®µåç§°ï¼š`avatar`

å…è®¸çš„åç¼€åï¼š`['.jpg', '.jpeg', '.bmp', '.webp', '.gif', '.png']`

æœ€å¤§å°ºå¯¸ï¼š`1M`

å“åº”æ ¼å¼ï¼š`JSON`

å“åº”ç»“æœç¤ºä¾‹ï¼š

```
// æˆåŠŸ
{
  "data": "æ–‡ä»¶çš„è®¿é—®åœ°å€"
}
// å¤±è´¥ï¼šåç¼€åä¸ç¬¦å·è¦æ±‚
{
  "errCode": 1,
  "errMsg": "åç¼€åä¸ç¬¦åˆè¦æ±‚"
}
// å¤±è´¥ï¼šæ–‡ä»¶è¿‡å¤§
{
  "errCode": 2,
  "errMsg": "æ–‡ä»¶è¿‡å¤§"
}
```

### 2.3.3 ChatGPT

#### 2.3.3.1 å‡†å¤‡å·¥ä½œï¼šå¯åŠ¨æœ¬åœ°æœåŠ¡å™¨

> å·²å®‰è£…å¥½nodeï¼Œä»¥åŠè®¾ç½®å¥½äº†npmçš„æ·˜å®æº

**å®‰è£…ä¾èµ–**

1. åœ¨å‘½ä»¤è¡Œè¿›å…¥`chat-server`ç›®å½•
2. è¿è¡Œ`npm i`

**å¯åŠ¨æœåŠ¡å™¨**

1. åœ¨å‘½ä»¤è¡Œè¿›å…¥`chat-server`ç›®å½•
2. è¿è¡Œ`npm run dev`

#### 2.3.3.2 èŠå¤©æ¥å£

è¯·æ±‚è·¯å¾„ï¼š`/chat`

è¯·æ±‚æ–¹æ³•ï¼š`POST`

è¯·æ±‚æ¶ˆæ¯æ ¼å¼ï¼š`application/json`

è¯·æ±‚ä½“æ ¼å¼ï¼š

```
// æ¸…é™¤å½“å‰çš„èŠå¤©ä¸Šä¸‹æ–‡
// æ¸…é™¤åï¼ŒæœåŠ¡å™¨ä¸å†è®°å½•ä¹‹å‰çš„èŠå¤©å†…å®¹ï¼Œåç»­çš„èŠå¤©å°†ä½¿ç”¨æ–°çš„ä¸Šä¸‹æ–‡
{
  "clear": true
}

// å‘é€æ¶ˆæ¯
{
  "content": "æˆ‘è¦ä½ æ‰®æ¼”æµ·ç»µå®å®çš„é­”æ³•æµ·èºå£³"
}
```

å“åº”æ ¼å¼ï¼š`çº¯æ–‡æœ¬`

```
å¥½çš„ï¼Œæˆ‘ç°åœ¨å¼€å§‹æ‰®æ¼”æµ·ç»µå®å®çš„é­”æ³•æµ·èºå£³ã€‚æˆ‘å¯ä»¥è¯´å‡ºå„ç§é­”æ³•è¯­è¨€å’Œå¸®åŠ©æµ·ç»µå®å®å’Œæ´¾å¤§æ˜Ÿè§£å†³é—®é¢˜ã€‚è®©æˆ‘ä»¬å¼€å§‹å†’é™©å§ï¼å™¢å‘µå‘µå‘µå‘µï¼
```

æ³¨æ„ï¼šå“åº”æ¯”è¾ƒè€—æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæµå¼çš„å°†æ–‡æœ¬å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒï¼Œå®¢æˆ·ç«¯æœ€å¥½æµå¼çš„æ¥æ”¶æ¶ˆæ¯ã€‚

### 2.3.4 å®æˆ˜ä»£ç 

#### 2.3.4.1 ç‹è€…è£è€€è‹±é›„åˆ—è¡¨ï¼ˆä½¿ç”¨fetchï¼‰

```
# httpæ„é€ 
GET /api/herolist HTTP/1.1
Host: study.duyiedu.com
```

index.css

```css
* {
  padding: 0;
  margin: 0;
  box-sizing: border-box;
}
ul {
  list-style: none;
}
a {
  text-decoration: none;
  color: inherit;
}

body {
  background: #ecedf2;
}
.container {
  width: 1140px;
  margin: 1em auto;
}

.search {
  margin-bottom: 30px;
  display: flex;
  justify-content: space-between;
  height: 100px;
  line-height: 50px;
}
.title {
  background: #5488d5;
  color: #fff;
  width: 80px;
  text-align: center;
  border-radius: 10px 0 0 10px;
}
.types {
  flex: 1 0 auto;
  color: #666;
  background: #fff;
  font-size: 14px;
}

.type-list {
  display: flex;
  padding-left: 20px;
}

.radio {
  margin-right: 30px;
  padding-left: 30px;
  position: relative;
  cursor: pointer;
}
.radio::before {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  border: 1px solid #ccc;
  border-radius: 50%;
}
.radio::after {
  content: '';
  position: absolute;
  width: 14px;
  height: 14px;
  left: 4px;
  top: 50%;
  transform: translateY(-50%) scale(0);
  background: #5f89cf;
  border-radius: 50%;
  transition: 0.25s;
}
.radio.checked::after {
  transform: translateY(-50%) scale(1);
}
.keyword {
  background: #fff;
  padding-right: 30px;
}
.input {
  margin-top: 50px;
  border: 1px solid #ccc;
  height: 40px;
  padding-right: 40px;
  border-radius: 5px;
  width: 300px;
  position: relative;
}
.input input {
  height: 100%;
  display: block;
  width: 100%;
  outline: none;
  border: none;
  border-radius: 5px;
  padding-left: 1em;
  font-size: 12px;
}
.input::before {
  content: '';
  position: absolute;
  width: 40px;
  height: 100%;
  right: 0;
  background: url('./search_icon.png') no-repeat center;
  border-left: 1px solid #ccc;
  height: 20px;
  top: 50%;
  transform: translateY(-50%);
}

.list {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  justify-items: center;
  text-align: center;
  font-size: 14px;
  row-gap: 20px;
  color: #333;
}
.list img {
  width: 77px;
  height: 77px;
  display: block;
  margin-bottom: 5px;
  border: 2px solid #5f89cf;
  border-radius: 10px 0 10px 0;
}
```

index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <div class="container">
      <ul class="list">
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
        <li>
          <a
            href="https://pvp.qq.com/web201605/herodetail/544.shtml"
            target="_blank"
          >
            <img
              src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/544/544.jpg"
              alt=""
            />
            <span>èµµæ€€çœŸ</span>
          </a>
        </li>
      </ul>
    </div>
    <script src="./index.js"></script>
  </body>
</html>
```

index.js

```js
// æ‹¿è‹±é›„æ•°æ® fetch
async function loadHeroes() {
  const resp = await fetch('https://study.duyiedu.com/api/herolist');
  // å½“å“åº”å¤´å®Œæ•´çš„è¢«æµè§ˆå™¨è¯»å–åˆ°åï¼Œè¯¥Promiseå®Œæˆ
  // console.log('å¤´éƒ¨ä¿¡æ¯å·²ç»åˆ°è¾¾å®¢æˆ·ç«¯');
  // console.log(resp.headers.get('Content-Type'));
  // console.log(resp.status);
  // console.log(resp.statusText);
  const body = await resp.json();
  document.querySelector('.list').innerHTML = body.data
    .map(
      (h) => `<li>
  <a
    href="https://pvp.qq.com/web201605/herodetail/${h.ename}.shtml"
    target="_blank"
  >
    <img
      src="https://game.gtimg.cn/images/yxzj/img201606/heroimg/${h.ename}/${h.ename}.jpg"
      alt=""
    />
    <span>${h.cname}</span>
  </a>
</li>`
    )
    .join('');
}

loadHeroes();
```

#### 2.3.4.2 å›¾ç‰‡ä¸Šä¼ å¹¶æ˜¾ç¤ºè¿›åº¦ï¼ˆä½¿ç”¨XHRï¼‰

```
# httpæ„é€ 
POST /upload/single HTTP/1.1
Host: myserver.com:9527
Content-Type: multipart/form-data; boundary=aaa

--aaa
Content-Disposition: form-data; name="avatar"; filename="small.jpg"
Content-Type: image/jpeg

< ./1.png
--aaa--
```

index.css

```css
.upload {
  --border-color: #dcdfe6;
  --font-color: #8c939d;
  --primary-color: #409eff;
  --danger-color: #eb685e;
}

.upload * {
  box-sizing: border-box;
}

.upload {
  width: 150px;
  height: 150px;
  position: relative;
  overflow: hidden;
  border-radius: 5px;
}

.upload .preview {
  object-fit: contain;
  z-index: 1;
}

.upload > * {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}

.upload > div {
  display: none;
  z-index: 2;
}

.upload.select .upload-select {
  display: block;
}
.upload.select .preview {
  display: none;
}

.upload.progress .upload-progress {
  display: block;
}

.upload.result .upload-result {
  display: block;
}

.upload-select {
  border-radius: inherit;
  border: 1px dashed var(--border-color);
  cursor: pointer;
}
.upload-select::before,
.upload-select::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  width: 30px;
  height: 3px;
  border-radius: 3px;
  background: var(--font-color);
  transform: translate(-50%, -50%);
}
.upload-select::after {
  transform: translate(-50%, -50%) rotate(90deg);
}
.upload-select input {
  opacity: 0;
  display: block;
  position: absolute;
  inset: 0;
}
.upload-select:hover {
  border-color: var(--primary-color);
}

.upload-progress {
  background: #00000080;
}

.progress-bar {
  position: absolute;
  width: 90%;
  height: 3px;
  background: #fff;
  border-radius: 3px;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  color: #fff;
  font-size: 12px;
}
.progress-bar::before {
  counter-reset: progress var(--percent);
  content: counter(progress) '%';
  position: absolute;
  left: 50%;
  top: -20px;
  transform: translateX(-50%);
}
.progress-bar::after {
  content: '';
  position: absolute;
  left: 0;
  border-radius: inherit;
  width: calc(1% * var(--percent));
  height: 100%;
  background: var(--primary-color);
}
.upload-progress::after {
  content: 'æ–‡ä»¶ä¸Šä¼ ä¸­...';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, 5px);
  white-space: nowrap;
  opacity: 0.8;
  color: #fff;
  font-size: 12px;
}
.upload button {
  border: none;
  outline: none;
  background: none;
  color: inherit;
  font-size: inherit;
  cursor: pointer;
  user-select: none;
}
.progress-bar button {
  left: 50%;
  position: absolute;
  top: 25px;
  transform: translateX(-50%);
}
.progress-bar button:hover {
  color: var(--danger-color);
}

.upload-result {
  border: 1px dashed var(--border-color);
  border-radius: inherit;
  overflow: hidden;
}

.upload-result button {
  width: 30px;
  height: 20px;
  background: var(--font-color);
  position: absolute;
  right: 0;
  top: 0;
  border-radius: 2px;
  color: #fff;
}
.upload-result button:hover {
  background: var(--danger-color);
}
```

index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ–‡ä»¶ä¸Šä¼ demo</title>
    <link rel="stylesheet" href="./css/index.css" />
  </head>
  <body>
    <div class="upload select">
      <div class="upload-select">
        <input type="file" />
      </div>
      <div class="upload-progress" style="--percent: 20">
        <div class="progress-bar">
          <button>å–æ¶ˆ</button>
        </div>
      </div>
      <div class="upload-result">
        <button>X</button>
      </div>
      <img src="./files/small.jpg" alt="" class="preview" />
    </div>
    <script src="./js/index.js"></script>
  </body>
</html>
```

index.js

```js
const $ = document.querySelector.bind(document);
const doms = {
  img: $('.preview'),
  container: $('.upload'),
  select: $('.upload-select'),
  selectFile: $('.upload-select input'),
  progress: $('.upload-progress'),
  cancelBtn: $('.upload-progress button'),
  delBtn: $('.upload-result button'),
};

function showArea(areaName) {
  doms.container.className = `upload ${areaName}`;
}

function setProgress(value) {
  doms.progress.style.setProperty('--percent', value);
}

doms.selectFile.onchange = (e) => {
  const file = e.target.files[0];
  // æ˜¾ç¤ºé¢„è§ˆå›¾
  const reader = new FileReader();
  reader.onload = (e) => {
    // è¯»å–å®Œæˆ
    doms.img.src = e.target.result;
    showArea('progress');
    upload(file);
  };
  reader.readAsDataURL(file); // å°†æ–‡ä»¶æ•°æ®è¯»å–ä¸º DataURLï¼ˆbase64ç¼–ç ï¼‰
};

function upload(file) {
  setProgress(0);
  // XHR
  const xhr = new XMLHttpRequest();
  xhr.open('POST', 'http://myserver.com:9527/upload/single'); // é…ç½®è¯·æ±‚
  xhr.upload.onprogress = (e) => {
    const percent = Math.floor((e.loaded / e.total) * 100);
    setProgress(percent);
  };
  xhr.onload = () => {
    showArea('result');
  };
  // xhr.abort(); // ä¸­æ­¢è¯·æ±‚
  const form = new FormData(); // ç”Ÿæˆmultipart/form-dataæ ¼å¼çš„è¯·æ±‚ä½“
  form.append('avatar', file);
  xhr.send(form);
}
```

#### 2.3.4.3

```
# httpæ„é€ 
POST /chat HTTP/1.1
Host: myserver.com:7010
Content-Type: application/json

{
  "clear": true
}
```

index.css

```css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
html {
  scroll-behavior: smooth;
}

::-webkit-scrollbar {
  height: 1rem;
  width: 0.5rem;
}

::-webkit-scrollbar-thumb {
  --tw-border-opacity: 1;
  background-color: rgba(217, 217, 227, 0.8);
  border-color: rgba(255, 255, 255, var(--tw-border-opacity));
  border-radius: 9999px;
  border-width: 1px;
}
::-webkit-scrollbar-thumb {
  --tw-bg-opacity: 1;
  background-color: rgba(86, 88, 105, var(--tw-bg-opacity));
}
body {
  background: #343541;
  -webkit-text-size-adjust: 100%;
  font-family: SÃ¶hne, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
    Ubuntu, Cantarell, Noto Sans, sans-serif, Helvetica Neue, Arial,
    Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
  line-height: 2;
  tab-size: 4;
}
body::after {
  content: '';
  position: fixed;
  width: 100%;
  height: 20%;
  background: linear-gradient(to top, #00000080, transparent);
  left: 0;
  bottom: 0;
  z-index: 10;
}
.block {
  padding: 12px;
  border-bottom: 1px solid rgba(32, 33, 35, 0.5);
}
.user {
  background: #343541;
  color: #e2e5e9;
}
.robot {
  background: #40414e;
  color: #d1d5db;
}
.container {
  max-width: 768px;
  margin: 0 auto;
  padding: 12px 0;
  display: flex;
  column-gap: 20px;
  align-items: start;
}
.avatar {
  background: #765bbd;
  width: 30px;
  height: 30px;
  border-radius: 3px;
  flex-shrink: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  white-space: nowrap;
}
.avatar img {
  width: 22px;
  height: 22px;
}
.robot .avatar {
  background: #000;
}
.title {
  font-size: 14px;
  text-align: center;
}
.main::after {
  content: '';
  display: block;
  height: 100px;
}
.send {
  position: fixed;
  z-index: 100;
  bottom: 30px;
  width: 100%;
  max-width: 768px;
  background: rgb(64, 65, 79);
  border-radius: 6px;
  border: 1px solid rgba(32, 33, 35, 0.5);
  box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px,
    rgba(0, 0, 0, 0.1) 0px 0px 15px 0px;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px;
  padding-right: 30px;
}
.send button {
  color: rgb(142, 142, 160);
  border: none;
  outline: none;
  width: 20px;
  height: 20px;
  display: flex;
  background: transparent;
  justify-content: center;
  align-items: center;
  border-radius: 2px;
  user-select: none;
  cursor: pointer;
  position: absolute;
  right: 15px;
  bottom: 15px;
}
.send button:hover {
  background: #000;
}
.send textarea {
  display: block;
  width: 100%;
  resize: none;
  outline: none;
  border: none;
  font-size: 16px;
  line-height: 2;
  margin-right: 30px;
  color: #fff;
  max-height: 200px;
  background: transparent;
}
.send .spin {
  display: none;
}
.send.waiting .submit {
  display: none;
}
.send.waiting .spin {
  display: flex;
  column-gap: 3px;
  background: none;
  cursor: wait;
}
.markdown-body {
  background: inherit;
}
.send.waiting .spin span {
  width: 4px;
  height: 4px;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 50%;
  animation: toggle 0.9s infinite;
  opacity: 0;
}
.send.waiting .spin span:nth-child(2) {
  animation-delay: 0.3s;
}
.send.waiting .spin span:nth-child(3) {
  animation-delay: 0.6s;
}

@keyframes toggle {
  30% {
    opacity: 1;
  }
}

.typing .content {
  position: relative;
}
.typing .content::after {
  content: '';
  position: absolute;
  width: 10px;
  height: 16px;
  background: #d5d9da;
  animation: toggle 0.6s infinite;
  opacity: 0;
  left: var(--x);
  top: var(--y);
}
```

index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatGPT-OpenAI</title>
    <link
      rel="shortcut icon"
      href="./asset/favicon-32x32.png"
      type="image/x-icon"
    />
    <link
      href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/github-markdown-css/5.1.0/github-markdown-dark.min.css"
      type="text/css"
      rel="stylesheet"
    />
    <link
      href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/highlight.js/11.4.0/styles/github-dark.min.css"
      type="text/css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <div class="main">
      <div class="robot block">
        <div class="title">ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶</div>
      </div>
    </div>
    <form class="send">
      <textarea rows="1"></textarea>
      <button class="submit" type="submit">
        <svg
          stroke="currentColor"
          fill="none"
          stroke-width="2"
          viewBox="0 0 24 24"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="h-4 w-4 mr-1"
          height="1em"
          width="1em"
          xmlns="http://www.w3.org/2000/svg"
        >
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
      <button class="spin" type="button">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </form>

    <script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/marked/4.0.2/marked.min.js"></script>
    <div class="markdown-body" id="content"></div>
    <script
      src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/highlight.js/11.4.0/highlight.min.js"
      type="application/javascript"
    ></script>
    <script src="./js/index.js"></script>
    <script src="./js/chat.js"></script>
  </body>
</html>
```

index.js

```js
var { createUserContent, createRobotContent } = (() => {
  marked.setOptions({
    highlight: function (code, lang) {
      if (lang && hljs.getLanguage(lang)) {
        return hljs.highlight(code, { language: lang }).value;
      }
      return hljs.highlightAuto(code).value;
    },
  });
  const txt = document.querySelector('.send textarea');
  txt.addEventListener('input', () => {
    txt.style.height = 'auto';
    txt.style.height = txt.scrollHeight + 'px';
  });
  const main = document.querySelector('.main');

  function _createUserContent(username, content) {
    const dom = document.createElement('div');
    dom.className = 'user block';
    dom.innerHTML = ` <div class="container">
    <div class="avatar">
      ${username}
    </div>
    <div class="content markdown-body">
      ${_normalizeContent(content)}
    </div>
  </div>`;
    const hitBottom = isBottom();
    main.appendChild(dom);
    if (hitBottom) {
      document.documentElement.scrollTo(0, 1000000);
    }
  }

  function _normalizeContent(content) {
    const html = marked.parse(content, {
      breaks: true,
      gfm: true,
    });
    return html;
  }
  const textarea = document.querySelector('.send textarea');
  function createUserContent(username) {
    const content = textarea.value.trim();
    _createUserContent(username, content);
    textarea.value = '';
    textarea.style.height = 'auto';
  }
  function _getLastTextNode(dom) {
    const children = dom.childNodes;
    for (let i = children.length - 1; i >= 0; i--) {
      const node = children[i];
      if (node.nodeType === Node.TEXT_NODE && /\S/.test(node.nodeValue)) {
        node.nodeValue = node.nodeValue.replace(/\s+$/, '');
        return node;
      } else if (node.nodeType === Node.ELEMENT_NODE) {
        const last = _getLastTextNode(node);
        if (last) {
          return last;
        }
      }
    }
    return null;
  }
  function _updateCursor(dom) {
    const contentDom = dom;
    const lastText = _getLastTextNode(contentDom);
    const textNode = document.createTextNode('\u200b');
    if (lastText) {
      lastText.parentElement.appendChild(textNode);
    } else {
      contentDom.appendChild(textNode);
    }
    const domRect = contentDom.getBoundingClientRect();
    const range = document.createRange();
    range.setStart(textNode, 0);
    range.setEnd(textNode, 0);
    const rect = range.getBoundingClientRect();
    const x = rect.left - domRect.left;
    const y = rect.top - domRect.top;
    dom.style.setProperty('--x', `${x}px`);
    dom.style.setProperty('--y', `${y}px`);
    textNode.remove();
  }

  function isBottom() {
    return (
      Math.abs(
        document.documentElement.scrollTop +
          document.documentElement.clientHeight -
          document.documentElement.scrollHeight
      ) < 20
    );
  }

  function createRobotContent() {
    const dom = document.createElement('div');
    dom.className = 'robot block typing';
    dom.innerHTML = ` <div class="container">
    <div class="avatar">
    <img src="./asset/gpt-avatar.svg" alt="" />
    </div>
    <div class="content markdown-body" style="--x: -1000px; --y: 0px"></div>
  </div>`;
    const contentDom = dom.querySelector('.content');
    let content = '';
    main.appendChild(dom);
    _updateCursor(contentDom);
    const form = document.querySelector('.send');
    form.classList.add('waiting');
    function append(text) {
      content += text;
      const html = _normalizeContent(content);
      const hitBottom = isBottom();

      contentDom.innerHTML = html;
      if (hitBottom) {
        document.documentElement.scrollTo(0, 1000000);
      }
      _updateCursor(contentDom);
    }

    return {
      append,
      over() {
        dom.classList.remove('typing');
        form.classList.remove('waiting');
      },
    };
  }

  return {
    createUserContent,
    createRobotContent,
    isBottom,
  };
})();
```

chat.js

```js
// æ¸…ç©ºèŠå¤©è®°å½•
fetch('http://myserver.com:7010/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    clear: true,
  }),
});

const form = document.querySelector('.send');
const textarea = document.querySelector('.send textarea');
const username = 'è¢';
textarea.onkeydown = (e) => {
  if (e.key === 'Enter' && !e.ctrlKey && !e.shiftKey) {
    e.preventDefault();
    form.dispatchEvent(new Event('submit'));
  }
};

form.onsubmit = async (e) => {
  e.preventDefault();
  const content = textarea.value;
  createUserContent(username);
  const robot = createRobotContent();
  // è¯·æ±‚æœåŠ¡å™¨
  const resp = await fetch('http://myserver.com:7010/chat', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      content,
    }),
  });
  const reader = resp.body.getReader();
  const decoder = new TextDecoder();
  while (1) {
    const { done, value } = await reader.read();
    if (done) {
      break;
    }
    const text = decoder.decode(value);
    robot.append(text);
  }
  robot.over();
};
```

# 3 è·¨åŸŸé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

## 3.1 åŒæºç­–ç•¥åŠè·¨åŸŸé—®é¢˜

**åŒæºç­–ç•¥**æ˜¯ä¸€å¥—æµè§ˆå™¨**å®‰å…¨æœºåˆ¶**ï¼Œå½“ä¸€ä¸ª**æº**çš„æ–‡æ¡£å’Œè„šæœ¬ï¼Œä¸å¦ä¸€ä¸ª**æº**çš„èµ„æºè¿›è¡Œé€šä¿¡æ—¶ï¼ŒåŒæºç­–ç•¥å°±ä¼šå¯¹è¿™ä¸ªé€šä¿¡åšå‡ºä¸åŒç¨‹åº¦çš„é™åˆ¶ã€‚

ç®€å•æ¥è¯´ï¼ŒåŒæºç­–ç•¥å¯¹ **åŒæºèµ„æº** **æ”¾è¡Œ**ï¼Œå¯¹ **å¼‚æºèµ„æº** **é™åˆ¶**

å› æ­¤é™åˆ¶é€ æˆçš„å¼€å‘é—®é¢˜ï¼Œç§°ä¹‹ä¸º**è·¨åŸŸï¼ˆå¼‚æºï¼‰é—®é¢˜**

### 3.1.1 åŒæºå’Œå¼‚æº

```
æº(origin) = åè®® + åŸŸå + ç«¯å£
```

ä¾‹å¦‚:

```
https://study.duyiedu.com/api/movie`çš„æºä¸º`https://study.duyiedu.com
http://localhost:7001/index.html`çš„æºä¸º`http://localhost:7001
```

ä¸¤ä¸ªURLåœ°å€çš„æº**å®Œå…¨ç›¸åŒ**ï¼Œåˆ™ç§°ä¹‹ä¸º**åŒæº**ï¼Œå¦åˆ™ç§°ä¹‹ä¸º**å¼‚æºï¼ˆè·¨åŸŸï¼‰**

![1720346826196](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346826196.png)

### 3.1.2 è·¨åŸŸå‡ºç°çš„åœºæ™¯

è·¨åŸŸå¯èƒ½å‡ºç°åœ¨ä¸‰ç§åœºæ™¯ï¼š

- **ç½‘ç»œé€šä¿¡**

  aå…ƒç´ çš„è·³è½¬ï¼›åŠ è½½cssã€jsã€å›¾ç‰‡ç­‰ï¼›AJAXç­‰ç­‰

- JS API

  `window.open`ã€`window.parent`ã€`iframe.contentWindow`ç­‰ç­‰

- å­˜å‚¨

  `WebStorage`ã€`IndexedDB`ç­‰ç­‰

å¯¹äºä¸åŒçš„è·¨åŸŸåœºæ™¯ï¼Œä»¥åŠæ¯ä¸ªåœºæ™¯ä¸­ä¸åŒçš„è·¨åŸŸæ–¹å¼ï¼ŒåŒæºç­–ç•¥éƒ½æœ‰ä¸åŒçš„é™åˆ¶ã€‚

æœ¬æ–‡é‡ç‚¹è®¨è®º**ç½‘ç»œé€šä¿¡**ä¸­`AJAX`çš„è·¨åŸŸé—®é¢˜

### 3.1.3 ç½‘ç»œä¸­çš„è·¨åŸŸ

å½“æµè§ˆå™¨è¿è¡Œé¡µé¢åï¼Œä¼šå‘å‡ºå¾ˆå¤šçš„ç½‘ç»œè¯·æ±‚ï¼Œä¾‹å¦‚CSSã€JSã€å›¾ç‰‡ã€AJAXç­‰ç­‰

è¯·æ±‚é¡µé¢çš„æºç§°ä¹‹ä¸º**é¡µé¢æº**ï¼Œåœ¨è¯¥é¡µé¢ä¸­å‘å‡ºçš„è¯·æ±‚ç§°ä¹‹ä¸º**ç›®æ ‡æº**ã€‚

å½“é¡µé¢æºå’Œç›®æ ‡æºä¸€è‡´æ—¶ï¼Œåˆ™ä¸º**åŒæºè¯·æ±‚**ï¼Œå¦åˆ™ä¸º**å¼‚æºè¯·æ±‚ï¼ˆè·¨åŸŸè¯·æ±‚ï¼‰**

![1720346875103](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346875103.png)

### 3.1.3 æµè§ˆå™¨å¦‚ä½•é™åˆ¶å¼‚æºè¯·æ±‚ï¼Ÿ

æµè§ˆå™¨å‡ºäºå¤šæ–¹é¢çš„è€ƒé‡ï¼Œåˆ¶å®šäº†éå¸¸ç¹æ‚çš„è§„åˆ™æ¥é™åˆ¶å„ç§è·¨åŸŸè¯·æ±‚ï¼Œä½†æ€»ä½“çš„åŸåˆ™éå¸¸ç®€å•ï¼š

- å¯¹æ ‡ç­¾å‘å‡ºçš„è·¨åŸŸè¯·æ±‚è½»å¾®é™åˆ¶
- å¯¹AJAXå‘å‡ºçš„è·¨åŸŸè¯·æ±‚**ä¸¥å‰é™åˆ¶**

![1720346910836](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346910836.png)

## 3.2 è§£å†³æ–¹æ¡ˆ

### 3.2.1 CORS

CORSï¼ˆCross-Origin Resource Sharingï¼‰æ˜¯æœ€æ­£ç»Ÿçš„è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿæ˜¯æµè§ˆå™¨æ¨èçš„è§£å†³æ–¹æ¡ˆã€‚

CORSæ˜¯ä¸€å¥—è§„åˆ™ï¼Œç”¨äºå¸®åŠ©æµè§ˆå™¨åˆ¤æ–­æ˜¯å¦æ ¡éªŒé€šè¿‡ã€‚

![1720346955929](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346955929.png)

CORSçš„åŸºæœ¬ç†å¿µæ˜¯ï¼š

- åªè¦æœåŠ¡å™¨æ˜ç¡®è¡¨ç¤º**å…è®¸**ï¼Œåˆ™æ ¡éªŒ**é€šè¿‡**
- æœåŠ¡å™¨æ˜ç¡®æ‹’ç»æˆ–æ²¡æœ‰è¡¨ç¤ºï¼Œåˆ™æ ¡éªŒä¸é€šè¿‡

**æ‰€ä»¥ï¼Œä½¿ç”¨CORSè§£å†³è·¨åŸŸï¼Œå¿…é¡»è¦ä¿è¯æœåŠ¡å™¨æ˜¯ã€Œè‡ªå·±äººã€**

#### 3.2.1.1 è¯·æ±‚åˆ†ç±»

CORSå°†è¯·æ±‚åˆ†ä¸ºä¸¤ç±»ï¼š==ç®€å•è¯·æ±‚==å’Œ==é¢„æ£€è¯·æ±‚==ã€‚

å¯¹ä¸åŒç§ç±»çš„è¯·æ±‚å®ƒçš„è§„åˆ™æœ‰æ‰€åŒºåˆ«ã€‚

æ‰€ä»¥è¦ç†è§£CORSï¼Œé¦–å…ˆè¦ç†è§£å®ƒæ˜¯å¦‚ä½•åˆ’åˆ†è¯·æ±‚çš„ã€‚

##### 3.2.1.1.1 ç®€å•è¯·æ±‚

> å®Œæ•´åˆ¤å®šé€»è¾‘ï¼šhttps://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests

ç®€å•æ¥è¯´ï¼Œåªè¦å…¨éƒ¨æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼Œå°±æ˜¯ç®€å•è¯·æ±‚ï¼š

- è¯·æ±‚æ–¹æ³•æ˜¯`GET`ã€`POST`ã€`HEAD`ä¹‹ä¸€

- å¤´éƒ¨å­—æ®µæ»¡è¶³CORSå®‰å…¨è§„èŒƒï¼Œè¯¦è§ W3C

  > æµè§ˆå™¨é»˜è®¤è‡ªå¸¦çš„å¤´éƒ¨å­—æ®µéƒ½æ˜¯æ»¡è¶³å®‰å…¨è§„èŒƒçš„ï¼Œåªè¦å¼€å‘è€…ä¸æ”¹åŠ¨å’Œæ–°å¢å¤´éƒ¨ï¼Œå°±ä¸ä¼šæ‰“ç ´æ­¤æ¡è§„åˆ™

- å¦‚æœæœ‰`Content-Type`ï¼Œå¿…é¡»æ˜¯ä¸‹åˆ—å€¼ä¸­çš„ä¸€ä¸ª

- - `text/plain`
  - `multipart/form-data`
  - `application/x-www-form-urlencoded`

##### 3.2.1.1.2 é¢„æ£€è¯·æ±‚(preflight)

åªè¦ä¸æ˜¯ç®€å•è¯·æ±‚ï¼Œå‡ä¸ºé¢„æ£€è¯·æ±‚

##### 3.2.1.1.3 ç»ƒä¹ 

```
// ä¸‹é¢çš„è·¨åŸŸè¯·æ±‚å“ªäº›æ˜¯ç®€å•è¯·æ±‚ï¼Œå“ªäº›æ˜¯é¢„æ£€è¯·æ±‚

// 1
fetch('https://douyin.com');

// 2
fetch('https://douyin.com', {
  headers: {
    a: 1,
  },
});

// 3
fetch('https://douyin.com', {
  method: 'POST',
  body: JSON.stringify({ a: 1, b: 2 }),
});

// 4
fetch('https://douyin.com', {
  method: 'POST',
  headers: {
    'content-type': 'application/json',
  },
  body: JSON.stringify({ a: 1, b: 2 }),
});
```

#### 3.2.1.2 å¯¹ç®€å•è¯·æ±‚çš„éªŒè¯

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)image-20230112204546583

#### 3.2.1.3 å¯¹é¢„æ£€è¯·æ±‚çš„éªŒè¯

1. å‘é€é¢„æ£€è¯·æ±‚

![1720346995548](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720346995548.png)

1. å‘é€çœŸå®è¯·æ±‚ï¼ˆå’Œç®€å•è¯·æ±‚ä¸€è‡´ï¼‰

#### 3.2.1.4 ç»†èŠ‚1 - å…³äºcookie

é»˜è®¤æƒ…å†µä¸‹ï¼Œajaxçš„è·¨åŸŸè¯·æ±‚å¹¶ä¸ä¼šé™„å¸¦cookieï¼Œè¿™æ ·ä¸€æ¥ï¼ŒæŸäº›éœ€è¦æƒé™çš„æ“ä½œå°±æ— æ³•è¿›è¡Œ

ä¸è¿‡å¯ä»¥é€šè¿‡ç®€å•çš„é…ç½®å°±å¯ä»¥å®ç°é™„å¸¦cookie

```js
// xhr
var xhr = new XMLHttpRequest();
xhr.withCredentials = true;

// fetch api
fetch(url, {
  credentials: "include"
})
```

è¿™æ ·ä¸€æ¥ï¼Œè¯¥è·¨åŸŸçš„ajaxè¯·æ±‚å°±æ˜¯ä¸€ä¸ª*é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚*

å½“ä¸€ä¸ªè¯·æ±‚éœ€è¦é™„å¸¦cookieæ—¶ï¼Œæ— è®ºå®ƒæ˜¯ç®€å•è¯·æ±‚ï¼Œè¿˜æ˜¯é¢„æ£€è¯·æ±‚ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ `cookie`å­—æ®µ

è€ŒæœåŠ¡å™¨å“åº”æ—¶ï¼Œéœ€è¦æ˜ç¡®å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼šæœåŠ¡å™¨å…è®¸è¿™æ ·çš„å‡­æ®

å‘ŠçŸ¥çš„æ–¹å¼ä¹Ÿéå¸¸çš„ç®€å•ï¼Œåªéœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ ï¼š`Access-Control-Allow-Credentials: true`å³å¯

å¯¹äºä¸€ä¸ªé™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼Œè‹¥æœåŠ¡å™¨æ²¡æœ‰æ˜ç¡®å‘ŠçŸ¥ï¼Œæµè§ˆå™¨ä»ç„¶è§†ä¸ºè·¨åŸŸè¢«æ‹’ç»ã€‚

å¦å¤–è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼š**å¯¹äºé™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸å¾—è®¾ç½® Access-Control-Allow-Origin çš„å€¼ä¸º\***ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨*çš„åŸå› 

#### 3.2.1.5 ç»†èŠ‚2 - å…³äºè·¨åŸŸè·å–å“åº”å¤´

åœ¨è·¨åŸŸè®¿é—®æ—¶ï¼ŒJSåªèƒ½æ‹¿åˆ°ä¸€äº›æœ€åŸºæœ¬çš„å“åº”å¤´ï¼Œå¦‚ï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaï¼Œå¦‚æœè¦è®¿é—®å…¶ä»–å¤´ï¼Œåˆ™éœ€è¦æœåŠ¡å™¨è®¾ç½®æœ¬å“åº”å¤´ã€‚

`Access-Control-Expose-Headers`å¤´è®©æœåŠ¡å™¨æŠŠå…è®¸æµè§ˆå™¨è®¿é—®çš„å¤´æ”¾å…¥ç™½åå•ï¼Œä¾‹å¦‚ï¼š

```
Access-Control-Expose-Headers: authorization, a, b
```

è¿™æ ·JSå°±èƒ½å¤Ÿè®¿é—®æŒ‡å®šçš„å“åº”å¤´äº†ã€‚

#### 3.2.1.6 æ¡ˆä¾‹

æœåŠ¡å™¨ç«¯

```js
const express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors');
const app = express();
app.use(cors());
app.use(bodyParser.json());

// jsonp
app.get('/jsonp', (req, res) => {
  const cbname = req.query.callback || 'callback';
  const data = {
    msg: 'æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯',
  };
  res.set('content-type', 'application/javascript');
  // res.end(`alert(1)`);
  res.end(`${cbname}(${JSON.stringify(data)})`);
});

// proxy
app.get('/hero', async (req, res) => {
  const axios = require('axios');
  const resp = await axios.get('https://pvp.qq.com/web201605/js/herolist.json');

  // ä½¿ç”¨CORSè§£å†³å¯¹ä»£ç†æœåŠ¡å™¨çš„è·¨åŸŸ
  res.header('access-control-allow-origin', '*');
  res.send(resp.data);
});

const PORT = 9527;

app.listen(PORT, () => {
  console.log(`server start on port ${PORT}`);
});
```

å®¢æˆ·ç«¯

index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      (async () => {
        const resp = await fetch('https://study.duyiedu.com/api/user/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            loginId: 'admin1',
            loginPwd: '123123',
          }),
        });
        const auth = resp.headers.get('Authorization');
        console.log(auth);
      })();
    </script>
  </body>
</html>
```

demo.html

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script></script>
  </body>
</html>
```

api.js

```js
function login(loginId, loginPwd) {
  return request('post', 'https://study.duyiedu.com/api/user/login', {
    body: {
      loginId,
      loginPwd,
    },
  }).then((resp) => resp.body.data);
}

function chat(content) {
  return request('post', 'https://study.duyiedu.com/api/chat', {
    body: {
      content,
    },
  }).then((resp) => resp.body.data);
}
```

request.js

```
window.request = (() => {
  const TOKEN_KEY = '__token__';

  const request = async (method, url, options = {}) => {
    options.headers = options.headers || {};

    // æ ¼å¼åŒ–options
    if (options.body && typeof options.body === 'object') {
      options.body = JSON.stringify(options.body);
      options.headers['content-type'] = 'application/json';
    }

    // æ˜¯å¦æºå¸¦token
    const token = localStorage.getItem(TOKEN_KEY);
    if (token) {
      // å‘è¯·æ±‚å¤´ä¸­åŠ å…¥å†…å®¹
      options.headers.authorization = `Bearer ${token}`;
    }

    const resp = await fetch(url, {
      ...options,
      method: method.toUpperCase(),
    });
    const headers = Object.fromEntries(resp.headers.entries());

    // æ£€æŸ¥å¤´ä¸­çš„token
    if (headers.authorization) {
      localStorage.setItem(TOKEN_KEY, headers.authorization);
    }

    const body = await resp.json();
    return {
      headers,
      body,
    };
  };
  return request;
})();
```

### 3.2.2 JSONP

åœ¨å¾ˆä¹…å¾ˆä¹…ä»¥å‰...å¹¶æ²¡æœ‰CORSæ–¹æ¡ˆ

![1720347463973](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347463973.png)

åœ¨é‚£ä¸ªå¹´ä»£ï¼Œå¤äººé ç€éå‡¡çš„æ™ºæ…§æ¥è§£å†³è¿™ä¸€é—®é¢˜

![1720347489027](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347489027.png)

è™½ç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†JSONPæœ‰ç€æ˜æ˜¾çš„ç¼ºé™·ï¼š

- ä»…èƒ½ä½¿ç”¨GETè¯·æ±‚

- å®¹æ˜“äº§ç”Ÿå®‰å…¨éšæ‚£

  > æ¶æ„æ”»å‡»è€…å¯èƒ½åˆ©ç”¨`callback=æ¶æ„å‡½æ•°`çš„æ–¹å¼å®ç°`XSS`æ”»å‡»

- å®¹æ˜“è¢«éæ³•ç«™ç‚¹æ¶æ„è°ƒç”¨

**å› æ­¤ï¼Œé™¤éæ˜¯æŸäº›ç‰¹æ®Šçš„åŸå› ï¼Œå¦åˆ™æ°¸è¿œä¸åº”è¯¥ä½¿ç”¨JSONP**

#### 3.2.2.1 æ¡ˆä¾‹

æœåŠ¡å™¨ç«¯

```js
const express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors');
const app = express();
app.use(cors());
app.use(bodyParser.json());

// jsonp
app.get('/jsonp', (req, res) => {
  const cbname = req.query.callback || 'callback';
  const data = {
    msg: 'æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯',
  };
  res.set('content-type', 'application/javascript');
  // res.end(`alert(1)`);
  res.end(`${cbname}(${JSON.stringify(data)})`);
});

// proxy
app.get('/hero', async (req, res) => {
  const axios = require('axios');
  const resp = await axios.get('https://pvp.qq.com/web201605/js/herolist.json');

  // ä½¿ç”¨CORSè§£å†³å¯¹ä»£ç†æœåŠ¡å™¨çš„è·¨åŸŸ
  res.header('access-control-allow-origin', '*');
  res.send(resp.data);
});

const PORT = 9527;

app.listen(PORT, () => {
  console.log(`server start on port ${PORT}`);
});
```

å®¢æˆ·ç«¯

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      function request(url) {
        return new Promise((resolve) => {
          // å‡†å¤‡ä¸€ä¸ªå…¨å±€å‡½æ•°
          // jsonp_
          const callbackName = `jsonp_${
            Math.random().toString(36).substring(2) + Date.now()
          }`;
          window[callbackName] = function (resp) {
            script.remove();
            delete window[callbackName];
            resolve(resp);
          };
          const script = document.createElement('script');
          script.src = url + '?callback=' + callbackName;
          document.body.appendChild(script);
        });
      }

      request('http://localhost:9527/jsonp').then((resp) => {
        console.log('ok', resp);
      });
    </script>
  </body>
</html>
```

### 3.2.3 ä»£ç†

CORSå’ŒJSONPå‡è¦æ±‚æœåŠ¡å™¨æ˜¯ã€Œè‡ªå·±äººã€

é‚£å¦‚æœä¸æ˜¯å‘¢ï¼Ÿ

![1720347544739](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347544739.png)

é‚£å°±æ‰¾ä¸€ä¸ªä¸­é—´äººï¼ˆä»£ç†ï¼‰

![1720347566333](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347566333.png)

æ¯”å¦‚ï¼Œå‰ç«¯å°ç‹æƒ³è¦è¯·æ±‚è·å–ç‹è€…è£è€€è‹±é›„æ•°æ®ï¼Œä½†ç›´æ¥è¯·æ±‚è…¾è®¯æœåŠ¡å™¨ä¼šé€ æˆè·¨åŸŸ

![1720347581285](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347581285.png)

ç”±äºè…¾è®¯æœåŠ¡å™¨ä¸æ˜¯ã€Œè‡ªå·±äººã€ï¼Œå°ç‹å†³å®šç”¨ä»£ç†è§£å†³

![1720347599561](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347599561.png)

### 3.2.4 å¦‚ä½•é€‰æ‹©

æœ€é‡è¦çš„ï¼Œæ˜¯è¦ä¿æŒ**ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒä¸€è‡´**

ä¸‹é¢æ˜¯ä¸€å¼ å†³ç­–å›¾

![1720347617847](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347617847.png)

å…·ä½“çš„å‡ ç§åœºæ™¯

![1720347635976](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347635976.png)

![1720347646543](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1720347646543.png)