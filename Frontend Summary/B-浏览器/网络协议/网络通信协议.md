## 协议

1、协议是什么

​       狭义的协议就是网络协议，是通信计算机双方必须遵从的一组约定，如怎样建立连接、怎样互相识别等。只有遵守约定，计算机之间才能相互通信交流。

​       广义上，各个行业组织出的技术规范与技术报告，国家标准，以及特定的具体业务信令流程，都可以称为“协议”。

​       协议栈是网络通信的基础，除了“协议”之外，还经常听说“规范”、“标准”等。



2、协议种类

​      通信协议的种类有很多，目前我接触的有 ：3GPP通信协议、网络应用层协议、蓝牙通信协议等，其实我们职业工作者无论学好哪一个协议，都能找到理想的工作岗位。

## 以太网原理

**1. 以太网原理**

**1.1 广播域、冲突域分别是什么意思？？HUB和switch的冲突域各有多大？**

​      广播域（broadcast domain）：广播帧传输的网络范围，一般是路由器来设定边界

​      冲突域（collision domain）：一个支持共享介质的网段，连接在同一导线上所有工作站的集合

​      HUB属于共享式网络，它的所有端口构成一个冲突域

​      Switch具有寻址功能，switch下的端口各为一个冲突域

**1.2 二层交换机和HUB的核心区别是？**

​      二层交换机工作在数据链路层上，而HUB工作在物理层上

​      二层交换机可以分割冲突域，但是HUB不可以

**1.3  Vlan的主要作用是？取值范围是什么？**

​     \1. 相同VLAN内主机可以任意通信

​     \2. 不同VLAN内主机二层流量完全隔离

​     \3. 相同VLAN跨设备通信

​     取值范围为1-4094

**1.4 简述TCP/IP、IOS的网络分层，以及其对比：**

​    OSI网络分层共七层，分别为物理层，数据链路层，网络层，传输层，会话层，表示层，应用层

   TCP/IP模型共四层，从上至下为应用层，传输层，网络层和主机到网络层

![1719137084078](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1719137084078.png)

**1.5 针对TCP/IP分层模型，分别列举所学习到的各层协议，并就最熟悉的详细描述其功能？**

​     主机到网络层协议有SLIP, 点对点PPP

​     网络层协议有IP协议和ICMP协议。IP协议为TCP、UDP、ICMP等协议提供传输的通路，IP层的主要目的是提供子网的互联，形成较大的网络，使不同的子网之间能传输数据

​     IP层的作用是数据传送，寻址，路由选择

​     传输层协议有TCP，UDP协议。TCP协议在原有IP协议的基础上，增加了确认重发、滑动窗口和复用/解复用等机制，提供一种可靠的、面向连接的、字节流服务；UDP是一种基于IP协议的不可靠网络传输协议

​     应用层协议有HTTP，FTP，Telnet等协议。HTTP协议是用于从WWW服务器传输超文本到本地浏览器的传输协议。HTTP是一个客户端和服务器端请求和应答的标准。它可以使浏览器更加高效，使网络传输减少。它不仅保证计算机正确快速地传输超文本文档，还确定传输文档中的哪一部分，以及哪部分内容首先显示(如文本先于图形)等。

**1.6 画出一个Ethernet II 数据帧格式**

![1719137100702](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1719137100702.png)

​     用这个报文中的对应字段的字节进行展示：

​     Dmac：00:09:06:10:1b:3c

​     Smac：70:f1:a1:66:5c:a5

​     eth_type: IP(0x0800)

​     data:

**1.7 组播的mac、广播mac分别是指？**

​     组播 MAC 地址是指第一个字节的最低位是 1 的 MAC 地址。

​     广播 MAC 地址是指每个比特都是 1 的 MAC 地址。广播 MAC 地址是组播 MAC 地址的一个特例。

**1.8 简述一次二层学习转发的流程？**

​     \1. 交换机接收网段上的所有数据帧

​    \2. 利用接收数据帧中的源MAC地址来建立MAC地址表（源地址自学习），使用地址老化机制进行地址表维护

​    \3. 在MAC地址表中查找数据帧中的目的MAC地址，如果找到就将该数据帧发送到相应的端口（不包括源端口）；如果找不到，就向所有的端口发送（不包括源端口）；

​    \4. 向所有端口转发广播帧和多播帧（不包括源端口）

**2.2. 网络架构**

**2.2.1 常规宽带互联网，网络架构分几层，分别是什么？**

​     3层时，分别是核心层，汇聚层，接入层

**1、接入层**

​      接入层利用光纤、双绞线、同轴电缆、无线接入技术等传输介质，实现与用户连接，并进行业务和带宽的分配。接入层目的是允许终端用户连接到网络，因此接入层交换机具有低成本和高端口密度特性。

**2、汇聚层**

​     汇聚层为接入层提供基于策略的连接，如地址合并，协议过滤，路由服务，认证管理等。通过网段划分（如VLAN）与网络隔离，可以防止某些网段的问题蔓延和影响到核心层。汇聚层同时也可以提供接入层虚拟网之间的互连，控制和限制接入层对核心层的访问，保证核心层的安全和稳定。

**3、核心层**

​       核心层的功能主要是实现骨干网络之间的优化传输，骨干层设计任务的重点通常是冗余能力、可靠性和高速的传输。核心层一直被认为是所有流量的最终承受者和汇聚者，所以对核心层的设计以及网络设备的要求十分严格。核心层设备将占投资的主要部分。核心层需要考虑冗余设计。核心层可以使网络的拓展性更强。

![1719137163594](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1719137163594.png)编辑

**主要特点**

​      每个片区内的两个核心节点之间采用2.5G的POS连接（如果将来有需求，可以升级到10G的POS连接）。核心层的8个节点按照上海电信传输汇接点的布局，分为4个大片：东北片、浦东片、中区片和西南片。

​     核心层节点采用CISCO12416设备，核心节点交换容量达到320G，核心节点之间以2.5Gbps POS互联，边缘层节点将根据实际情况，分别选用CISCO12012和CISCO Catalyst6509设备，中继连接速率达到2.5G。在与核心层节点的连接时，采用光纤直连的POS技术。每个边缘节点与本片区内的两台交换路由设备相连，保证网络的冗余备份。   

​     2层时，分别是核心层，接入层

**2.2.2 整个网络架构物理上是怎么构成的，需要哪些基础设备？**

​     网络的物理架构指的是网络分层, 也就是计算机的层结构, 比如TCP/IP四层,以及ISO提出的七层结构

​     Dslam、计算机、防火墙、交换机、路由器、服务器、存储设备等

## 详细ping操作原理

![1719137245236](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1719137245236.png)



**1. 简述一次ping操作的全过程（原理）**

**1.1 同一网段内的ping操作**

主机A去ping同一网段的主机B，它会封装二层报文，首先去查本地MAC地址表，发现没有B的地址，此时就会发送ARP报文。

目的MAC：源MAC：OP：发送端MAC：发送端IP：目的端MAC：目的端IP

交换机收到A的ARP请求后，就会将查找自己的MAC地址表，如果有，则直接返回给A；如果没有则从所有端口将该报文广播出去；B接收到报文后，给A返回报文，这样A就学到了B的MAC地址；

A封装ICMP Request报文，发送给B，将学到的MAC地址封装到报文头部，利用MAC地址进行通信；

B收到后，回复报文icmp echo reply

![1719137260956](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1719137260956.png)

*1.ping通知系统建立一个固定格式的ICMP请求数据包。*

*2.ICMP协议打包这个数据包和机器B的IP地址转交给IP协议层（一组后台运行的进程，与ICMP类似）。*

*3.IP层协议将以机器B的IP地址为目的地址，本机IP地址为源地址，加上一些其他的控制信息，构建一个IP数据包。*

*4.获取机器B的MAC地址*

​     *4.1 IP层协议通过机器B的IP地址和自己的子网掩码，发现它跟自己属同一网络，就直接在本网络查找这台机器的MAC：若两台机器之前有过通信，在机器A的ARP缓存表应该有B机IP与其MAC的映射关系；若没有，则发送ARP请求广播，得到机器B的MAC地址，一并交给数据链路层。*

​     *4.2 数据链路层构建一个数据帧，目的地址是IP层传过来的MAC地址，源地址是本机的MAC地址，再附加一些控制信息，依据以太网的介质访问规则，将他们传送出去。*

​     *4.3 机器B收到这个数据帧后，先检查目的地址，和本机MAC地址对比*

​     *符合，接收。接收后检查该数据帧，将IP数据包从帧中提取出来，交给本机的IP协议层协议。IP层检查后，将有用的信息提取交给ICMP协议，后者处理后，马上构建一个ICMP应答包，发送给主机A，其过程和主机A发送ICMP请求包到主机B类似（这时候主机B已经知道了主机A的MAC地址，不需再发ARP请求）。*

​     *不符合，丢弃。*

**1.2 不同网段的ping**

​     首先A想发报文给C，查找MAC地址表发现，没有C的MAC地址，同时发现C与自己不在一个网段，于是它先发送一个ARP请求，学习到网关的MAC地址；这里可以把网关理解为同一网段的B；

​      然后再把ICMP报文封装好，发送给网关；报文到达网关之后，路由器根据目的地址查找路由表，找到转发出口。去掉原来的MAC头部。换成如下的头部：

​     目的地址/源地址：C的MAC/另一侧网关的MAC 其他的不变

​     如果路由器也没有C的MAC地址，则从转发端口先发送ARP报文，学习C的MAC地址。



***不同网段：***

​    *1.ping通知系统建立一个固定格式的ICMP请求数据包*

​    *2.ICMP协议打包这个数据包和机器B的IP地址转交给IP协议层（一组后台运行的进程，与ICMP类似）*

​    *3.IP层协议将以机器B的IP地址为目的地址，本机IP地址为源地址，加上一些其他的控制信息，构建一个IP数据包*

​    *4.获取主机B的MAC地址*

​     *IP协议通过计算发现主机B与自己不在同一网段内，就直接交给路由处理，就是将路由的MAC取过来，和之前一样，先在ARP缓存表中寻找路由MAC，若找不到可以利用广播。路由得到这个数据帧之后，再跟主机B联系，若找不到，就向主机A返回一个超时信息。*



**2. 假如遇到了执行ping命令和远程主机无法ping通，请分析问题的原因，并给出分析解决思路**。

\1. 目的ip是否存在，检查自己IP是否输入错误，和远程主机IP是否一致

\2. 网段不同，通过路由也无法找到，排查是否能ping通网关，若正常，再排查网关到远程主机之间的通路是否正常。一般也可以使用tracert命令来确认哪一段的路由出现了问题。

\3. 防火墙设置，过滤了ping发出的ICMP数据包，导致无反馈，time out, 尝试ping之后我们可以通过arp –a的命令查看列表中是否有对应的IP的MAC，如果有，那就很有可能是防火墙的问题了。

\4. 网线故障，物理连接有问题，可以查看网线的指示灯是否常亮，或者在主机上查看网口是不是连接状态，或者说ping一个正常能通的IP来确认物理连接是否有问题。

**对ping后返回信息进行分析**

1.Request timed out

   对方已关机，或者网络上没有这个地址

   对方与自己不在同一网段内，通过路由也无法到达

   对方存在，不过设置了ICMP数据包过滤（比如防火墙设置）

   错误设置IP地址

​    正常情况下，一台主机一张网卡，一个IP地址或多个网卡，多个IP地址。但如果一台电脑的“拨号网络适配器”（相当于一块软网卡）的TCO/IP设置中，设置了一个与网卡IP地址处于同一子网的IP地址，这样，在IP层协议看来，这台主机就有两个不同的接口处于同一网段内。当从这台主机ping其他机器时，会存在这样的问题：

** 主机不知道将数据包发到哪个网络接口，因为有两个网络接口都连接在同一网段。

** 主机不知道用哪个地址作为数据包的源地址。因此，从这台主机去ping其他机器，IP层协议会无法处理，超时后，ping就会给出一个“超时无应答”的错误信息提示。但从其他主机ping这台主机时，请求包从特定网卡来，ICMP只须简单的将目的、源地址互换，并更改一些标志即可，ICMP应答包能顺利发出，其他主机就能成功ping通这台主机了。



2.Destination host Unreachable

​    自己未设定默认路由，对方跟自己不在同已网段；检查网线是否有问题。

3.Request timed out 与 Destination host Unreachable 的区别

​     所经过的路由器的路由表具有到达目标的路由，而目标因为原因不可到达，这时出现前者。如果路由表中连到达目标的路由都没有，就会出现后者。

4.Bad ip address

​    没有连接到DNS服务器，无法解析IP，也可能是IP不存在。

5.Source quench received

​    对方或中途服务器繁忙而无法应答。

6.Unkonw host

​    远程主机的名字不能被域名服务器转换成IP地址，故障原因可能是DNS服务器有故障，或者名字不正确，或者网络管理员的系统与远程主机之间的通信线路故障，检查是否存在这些问题。

7.No answer

​    无响应。说明本地系统有一条通向中心主机的路由，但却接收不到它发给该中心主机的信息。故障原因可能是：中心主机没有工作；本地或中心主机网络配置不正确；本地或中心的路由器没有工作；通信线路有故障；中心主机存在路由选择问题。

8.Ping 127.0.0.1

​    如果ping不通，则表明本地址TCP/IP协议不能正常工作

9.no rout to host

​    网卡工作不正常

10.transmit failed。error code

​    10043网卡驱动不正常

11.unknown host name

​    DNS配置不正确