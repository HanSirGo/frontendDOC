## å‰ç«¯å®ç°æ–‡ä»¶é¢„è§ˆimgã€docxã€xlsxã€pptã€pdfã€mdã€txtã€audioã€video

### å‰è¨€

> â
>
> æœ€è¿‘æœ‰æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å‰ç«¯æ”¯æŒä¸Šä¼ åˆ¶å®šåç¼€æ–‡ä»¶ï¼Œä¸”æ”¯æŒé¡µé¢é¢„è§ˆï¼Œä¸Šä¼ ç®€å•ï¼Œé‚£ä¹ˆé¢„è§ˆè¯¥æ€ä¹ˆå®ç°å‘¢ï¼Œå°¤å…¶æ˜¯ä¸åŒç±»å‹çš„æ–‡ä»¶é¢„è§ˆæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸‹é¢å°±æˆ‘è¿™ä¸ªéœ€æ±‚çš„å®ç°ï¼Œç­”æ¡ˆåœ¨ä¸‹é¢ ğŸ‘‡ï¼š
>
> â

**ã€Œå…·ä½“çš„é¢„è§ˆéœ€æ±‚ï¼šã€**é¢„è§ˆéœ€è¦æ”¯æŒçš„æ–‡ä»¶ç±»å‹æœ‰ï¼š`pngã€jpgã€jpegã€docxã€xlsxã€pptã€pdfã€mdã€txtã€audioã€video`ï¼Œå¦å¤–å¯¹äºä¸åŒæ–‡æ¡£è¿˜éœ€è¦æœ‰å®šä½çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š`pdf` å®šä½åˆ°é¡µç ï¼Œ`txt`å’Œ`markdown`å®šä½åˆ°æ–‡å­—å¹¶æ»šåŠ¨åˆ°æŒ‡å®šçš„ä½ç½®ï¼ŒéŸ³è§†é¢‘å®šä½åˆ°å…·ä½“çš„æ—¶é—´ç­‰ç­‰ã€‚

------

> **ã€Œâš ï¸ è¡¥å……ï¼šæˆ‘çš„éœ€æ±‚æ˜¯éœ€è¦å…ˆå°†æ–‡ä»¶ä¸Šä¼ åˆ°åå°ï¼Œæ‰€ä»¥æˆ‘æ‹¿åˆ°çš„æ˜¯urlåœ°å€å»å±•ç¤ºï¼Œå¯¹äºmarkdownå’Œtxtçš„æ–‡ä»¶éœ€è¦å…ˆç”¨fetchè·å–ï¼Œå…¶ä»–çš„å±•ç¤ºåˆ™ç›´æ¥ä½¿ç”¨urlé“¾æ¥å°±å¯ä»¥ã€‚ã€**

ä¸åŒæ–‡ä»¶çš„å®ç°æ–¹å¼ä¸åŒï¼Œä¸‹é¢åˆ†ç±»è®²è§£ï¼Œæ€»å…±åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

1. è‡ªæœ‰æ ‡ç­¾æ–‡ä»¶ï¼š`pngã€jpgã€jpegã€audioã€video`
2. çº¯æ–‡å­—çš„æ–‡ä»¶ï¼š`markdown & txt`
3. `office` ç±»å‹çš„æ–‡ä»¶ï¼š`docxã€xlsxã€ppt`
4. `embed` å¼•å…¥æ–‡ä»¶ï¼š`pdf`
5. `iframe`ï¼šå¼•å…¥å¤–éƒ¨å®Œæ•´çš„ç½‘ç«™

------

### è‡ªæœ‰æ ‡ç­¾æ–‡ä»¶ï¼š`pngã€jpgã€jpegã€audioã€video`

> â
>
> å¯¹äºå›¾ç‰‡ã€éŸ³è§†é¢‘çš„é¢„è§ˆï¼Œç›´æ¥ä½¿ç”¨å¯¹åº”çš„æ ‡ç­¾å³å¯ï¼Œå¦‚ä¸‹ï¼š
>
> â

#### å›¾ç‰‡ï¼š`pngã€jpgã€jpeg`

**ã€Œç¤ºä¾‹ä»£ç ï¼šã€**

```
 <img src={url} key={docId} alt={name} width="100%" />;
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716031768577](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716031768577.png)

#### éŸ³é¢‘ï¼š`audio`

**ã€Œç¤ºä¾‹ä»£ç ï¼šã€**

```js
<audio ref={audioRef} controls controlsList="nodownload" style={{ width: '100%' }}>
  <track kind="captions" />
  <source src={url} type="audio/mpeg" />
</audio>
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716031791780](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716031791780.png)

#### è§†é¢‘ï¼š`video`

**ã€Œç¤ºä¾‹ä»£ç ï¼šã€**

```html
<video ref={videoRef} controls muted controlsList="nodownload" style={{ width: '100%' }}>
  <track kind="captions" />
  <source src={url} type="video/mp4" />
</video>
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716031851836](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716031851836.png)

**ã€Œå…³äºéŸ³è§†é¢‘çš„å®šä½çš„å®Œæ•´ä»£ç ï¼šã€**

```js
import React, { useRef, useEffect } from 'react';

interface IProps {
  type: 'audio' | 'video';
  url: string;
  timeInSeconds: number;
}

function AudioAndVideo(props: IProps) {
  const { type, url, timeInSeconds } = props;
  const videoRef = useRef<HTMLVideoElement>(null);
  const audioRef = useRef<HTMLAudioElement>(null);

  useEffect(() => {
    // éŸ³è§†é¢‘å®šä½
    const secondsTime = timeInSeconds / 1000;
    if (type === 'audio' && audioRef.current) {
      audioRef.current.currentTime = secondsTime;
    }
    if (type === 'video' && videoRef.current) {
      videoRef.current.currentTime = secondsTime;
    }
  }, [type, timeInSeconds]);

  return (
    <div>
      {type === 'audio' ? (
        <audio ref={audioRef} controls controlsList="nodownload" style={{ width: '100%' }}>
          <track kind="captions" />
          <source src={url} type="audio/mpeg" />
        </audio>
      ) : (
        <video ref={videoRef} controls muted controlsList="nodownload" style={{ width: '100%' }}>
          <track kind="captions" />
          <source src={url} type="video/mp4" />
        </video>
      )}
    </div>
  );
}

export default AudioAndVideo;
```

------

### çº¯æ–‡å­—çš„æ–‡ä»¶ï¼š`markdown & txt`

> â
>
> å¯¹äº`markdownã€txt`ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚æœæ‹¿åˆ°çš„æ˜¯æ–‡ä»¶çš„`url`çš„è¯ï¼Œåˆ™æ— æ³•ç›´æ¥æ˜¾ç¤ºï¼Œéœ€è¦è¯·æ±‚åˆ°å†…å®¹ï¼Œå†è¿›è¡Œå±•ç¤ºã€‚
>
> â

#### `markdown` æ–‡ä»¶

> â
>
> åœ¨å±•ç¤º`markdown`æ–‡ä»¶æ—¶ï¼Œéœ€è¦æ»¡è¶³å­—ä½“é«˜äº®ã€ä»£ç é«˜äº®ã€å¦‚æœæœ‰å­—ä½“é«˜äº®ï¼Œéœ€è¦æ»šåŠ¨åˆ°å­—ä½“æ‰€åœ¨ä½ç½®ã€å¦‚æœæœ‰å¤–éƒ¨é“¾æ¥ï¼Œéœ€è¦æ–°å¼€tabé¡µé¢å†æ‰“å¼€ã€‚
>
> â

éœ€è¦å¼•å…¥ä¸¤ä¸ªåº“ï¼š

`marked`ï¼šå®ƒçš„ä½œç”¨æ˜¯å°†`markdown`æ–‡æœ¬è½¬æ¢ï¼ˆè§£æï¼‰ä¸º`HTML`ã€‚

`highlight`ï¼šå®ƒå…è®¸å¼€å‘è€…åœ¨ç½‘é¡µä¸Šé«˜äº®æ˜¾ç¤ºä»£ç ã€‚

**ã€Œå­—ä½“é«˜äº®çš„ä»£ç å®ç°ï¼šã€**

> â
>
> é«˜äº®çš„æ ·å¼ï¼Œå¯ä»¥åœ¨è¡Œé—´æ ·å¼å®šä¹‰
>
> â

```js
 const highlightAndMarkFirst = (text: string, highlightText: string) => {
    let firstMatchDone = false;
    const regex = new RegExp(`(${highlightText})`, 'gi');
    return text.replace(regex, (match) => {
      if (!firstMatchDone) {
        firstMatchDone = true;
        return `<span id='first-match' style="color: red;">${match}</span>`;
      }
      return `<span style="color: red;">${match}</span>`;
    });
  };
```

**ã€Œä»£ç é«˜äº®çš„ä»£ç å®ç°ï¼šã€**

> â
>
> éœ€è¦å€ŸåŠ©`hljs`è¿™ä¸ªåº“è¿›è¡Œè½¬æ¢
>
> â

```js
marked.use({
    renderer: {
      code(code, infostring) {
        const validLang = !!(infostring && hljs.getLanguage(infostring));
        const highlighted = validLang
          ? hljs.highlight(code, { language: infostring, ignoreIllegals: true }).value
          : code;
        return `<pre><code class="hljs ${infostring}">${highlighted}</code></pre>`;
      } 
    },
  });
```

**ã€Œé“¾æ¥è·³è½¬æ–°tabé¡µçš„ä»£ç å®ç°:ã€**

```js
marked.use({
   renderer: {
      // é“¾æ¥è·³è½¬
      link(href, title, text) {
        const isExternal = !href.startsWith('/') && !href.startsWith('#');
        if (isExternal) {
          return `<a href="${href}" title="${title}" target="_blank" rel="noopener noreferrer">${text}</a>`;
        }
        return `<a href="${href}" title="${title}">${text}</a>`;
      },
    },
});
```

**ã€Œæ»šåŠ¨åˆ°é«˜äº®çš„ä½ç½®çš„ä»£ç å®ç°ï¼šã€**

> â
>
> éœ€è¦é…åˆä¸Šé¢çš„ä»£ç é«˜äº®çš„æ–¹æ³•
>
> â

```js
const firstMatchElement = document.getElementById('first-match');
if (firstMatchElement) {
    firstMatchElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
}
```

**ã€Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼šã€**

> â
>
> å…¥å‚çš„`docUrl` æ˜¯`markdown`æ–‡ä»¶çš„çº¿ä¸Š`ur`låœ°å€ï¼Œ`searchText` æ˜¯éœ€è¦é«˜äº®çš„å†…å®¹ã€‚
>
> â

```js
import React, { useEffect, useState, useRef } from 'react';
import { marked } from 'marked';
import hljs from 'highlight.js';

const preStyle = {
  width: '100%',
  maxHeight: '64vh',
  minHeight: '64vh',
  overflow: 'auto',
};

// Markdownå±•ç¤ºç»„ä»¶
function MarkdownViewer({ docUrl, searchText }: { docUrl: string; searchText: string }) {
  const [markdown, setMarkdown] = useState('');
  const markdownRef = useRef<HTMLDivElement | null>(null);

  const highlightAndMarkFirst = (text: string, highlightText: string) => {
    let firstMatchDone = false;
    const regex = new RegExp(`(${highlightText})`, 'gi');
    return text.replace(regex, (match) => {
      if (!firstMatchDone) {
        firstMatchDone = true;
        return `<span id='first-match' style="color: red;">${match}</span>`;
      }
      return `<span style="color: red;">${match}</span>`;
    });
  };

  useEffect(() => {
    // å¦‚æœæ²¡æœ‰æœç´¢å†…å®¹ï¼Œç›´æ¥åŠ è½½åŸå§‹Markdownæ–‡æœ¬
    fetch(docUrl)
      .then((response) => response.text())
      .then((text) => {
        const highlightedText = searchText ? highlightAndMarkFirst(text, searchText) : text;
        setMarkdown(highlightedText);
      })
      .catch((error) => console.error('åŠ è½½Markdownæ–‡ä»¶å¤±è´¥ï¼š', error));
  }, [searchText, docUrl]);

  useEffect(() => {
    if (markdownRef.current) {
      // æ”¯æŒä»£ç é«˜äº®
      marked.use({
        renderer: {
          code(code, infostring) {
            const validLang = !!(infostring && hljs.getLanguage(infostring));
            const highlighted = validLang
              ? hljs.highlight(code, { language: infostring, ignoreIllegals: true }).value
              : code;
            return `<pre><code class="hljs ${infostring}">${highlighted}</code></pre>`;
          },
          // é“¾æ¥è·³è½¬
          link(href, title, text) {
            const isExternal = !href.startsWith('/') && !href.startsWith('#');
            if (isExternal) {
              return `<a href="${href}" title="${title}" target="_blank" rel="noopener noreferrer">${text}</a>`;
            }
            return `<a href="${href}" title="${title}">${text}</a>`;
          },
        },
      });
      const htmlContent = marked.parse(markdown);
      markdownRef.current!.innerHTML = htmlContent as string;
      // å½“markdownæ›´æ–°åï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ»šåŠ¨åˆ°é«˜äº®ä½ç½®
      const firstMatchElement = document.getElementById('first-match');
      if (firstMatchElement) {
        firstMatchElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
  }, [markdown]);

  return (
    <div style={preStyle}>
      <div ref={markdownRef} />
    </div>
  );
}

export default MarkdownViewer;
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716032014407](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716032014407.png)

#### `txt` æ–‡ä»¶é¢„è§ˆå±•ç¤º

> â
>
> æ”¯æŒé«˜äº®å’Œæ»šåŠ¨åˆ°æŒ‡å®šä½ç½®
>
> â

**ã€Œæ”¯æŒé«˜äº®çš„ä»£ç ï¼šã€**

```js
  function highlightText(text: string) {
    if (!searchText.trim()) return text;
    const regex = new RegExp(`(${searchText})`, 'gi');
    return text.replace(regex, `<span style="color: red">$1</span>`);
  }
```

**ã€Œå®Œæ•´ä»£ç ï¼šã€**

```js
import React, { useEffect, useState, useRef } from 'react';
import { preStyle } from './config';

function TextFileViewer({ docurl, searchText }: { docurl: string; searchText: string }) {
  const [paragraphs, setParagraphs] = useState<string[]>([]);
  const targetRef = useRef<HTMLDivElement | null>(null);

  function highlightText(text: string) {
    if (!searchText.trim()) return text;
    const regex = new RegExp(`(${searchText})`, 'gi');
    return text.replace(regex, `<span style="color: red">$1</span>`);
  }

  useEffect(() => {
    fetch(docurl)
      .then((response) => response.text())
      .then((text) => {
        const highlightedText = highlightText(text);
        const paras = highlightedText
          .split('\n')
          .map((para) => para.trim())
          .filter((para) => para);
        setParagraphs(paras);
      })
      .catch((error) => {
        console.error('åŠ è½½æ–‡æœ¬æ–‡ä»¶å‡ºé”™:', error);
      });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [docurl, searchText]);

  useEffect(() => {
    //  å¤„ç†é«˜äº®æ®µè½çš„æ»šåŠ¨é€»è¾‘
    const timer = setTimeout(() => {
      if (targetRef.current) {
        targetRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }, 100);

    return () => clearTimeout(timer);
  }, [paragraphs]);

  return (
    <div style={preStyle}>
      {paragraphs.map((para: string, index: number) => {
        const paraKey = para + index;

        // ç¡®å®šè¿™ä¸ªæ®µè½æ˜¯å¦åŒ…å«é«˜äº®æ–‡æœ¬
        const isTarget = para.includes(`>${searchText}<`);
        return (
          <p key={paraKey} ref={isTarget && !targetRef.current ? targetRef : null}>
            <div dangerouslySetInnerHTML={{ __html: para }} />
          </p>
        );
      })}
    </div>
  );
}

export default TextFileViewer;
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716032048434](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716032048434.png)

------

### `office` ç±»å‹çš„æ–‡ä»¶ï¼š`docxã€xlsxã€ppt`

> â
>
> `docxã€xlsxã€ppt` æ–‡ä»¶çš„é¢„è§ˆï¼Œç”¨çš„æ˜¯`office`çš„çº¿ä¸Šé¢„è§ˆé“¾æ¥ + æˆ‘ä»¬æ–‡ä»¶çš„çº¿ä¸Š`url`å³å¯ã€‚
>
> â

> â
>
> å…³äºå®šä½ï¼šç”¨è¿™ç§æ–¹æ³•æˆ‘æš‚æ—¶å°è¯•æ˜¯æ— æ³•å®šä½é¡µç çš„ï¼Œæ‰€ä»¥å®šä½çš„åŠŸèƒ½æˆ‘é‡‡å–çš„æ˜¯åç«¯å°†`office` æ–‡ä»¶è½¬æˆ`pdf`ï¼Œå†è¿›è¡Œå®šä½ï¼Œå¦‚æœåªæ˜¯çº¯å±•ç¤ºï¼Œå¿½ç•¥è¿™ä¸ªé—®é¢˜å³å¯ã€‚
>
> â

**ã€Œç¤ºä¾‹ä»£ç ï¼šã€**

```html
<iframe
    src={`https://view.officeapps.live.com/op/view.aspx?src=${url}`}
    width="100%"
    height="500px"
    frameBorder="0"
></iframe>
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716032073609](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716032073609.png)

------

### `embed` å¼•å…¥æ–‡ä»¶ï¼š`pdf`

> â
>
> åœ¨`pdf`æ–‡æ¡£é¢„è§ˆæ—¶ï¼Œå¯ä»¥é‡‡ç”¨`embed`çš„æ–¹å¼ï¼Œè¿™ä¸ª`httpsUrl`å°±æ˜¯ä½ çš„`pdf`æ–‡æ¡£çš„é“¾æ¥åœ°å€
>
> â

**ã€Œç¤ºä¾‹ä»£ç ï¼šã€**

```
 <embed src={`${httpsUrl}`} style={preStyle} key={`${httpsUrl}`} />;
```

å…³äºå®šä½ï¼Œå…¶å®æ˜¯åœ°å€ä¸Šæ‹¼æ¥çš„é¡µç `sourcePage`ï¼Œå¦‚ä¸‹ï¼š

```js
 const httpsUrl = sourcePage
        ? `${doc.url}#page=${sourcePage}`
        : doc.url;
        
<embed src={`${httpsUrl}`} style={preStyle} key={`${httpsUrl}`} />;
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716032133050](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716032133050.png)

------

### `iframe`ï¼šå¼•å…¥å¤–éƒ¨å®Œæ•´çš„ç½‘ç«™

> â
>
> é™¤äº†ä¸Šé¢çš„å„ç§æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é¢„è§ˆä¸€äº›å¤–éƒ¨çš„ç½‘å€ï¼Œé‚£å°±è¦ç”¨åˆ°`iframe`çš„æ–¹å¼
>
> â

**ã€Œç¤ºä¾‹ä»£ç ï¼šã€**

```js
 <iframe
    title="ç½‘å€"
    width="100%"
    height="100%"
    src={doc.url}      
    allow="microphone;camera;midi;encrypted-media;"/>
```

**ã€Œé¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼šã€**

![1716032155801](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1716032155801.png)