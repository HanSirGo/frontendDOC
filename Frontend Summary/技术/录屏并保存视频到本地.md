# çº¯å‰ç«¯å¦‚ä½•å®ç°å½•å±å¹¶ä¿å­˜è§†é¢‘åˆ°æœ¬åœ°

ä½œä¸ºä¸€ä¸ªèµ„æ·±çš„åˆ‡å›¾ä»”ï¼Œæˆ‘ä»¬éš¾å…ä¼šéœ€è¦ç”¨åˆ°æŠŠè‡ªå·±å†™çš„é¡µé¢çš„ä¸€äº›åŠŸèƒ½é€šè¿‡è§†é¢‘çš„æ–¹å¼åˆ†äº«ç»™åˆ«äººã€‚è¿˜æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œå°±æ˜¯å½“æˆ‘ä»¬é¢è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬çš„å±å¹•åˆ†äº«ç»™é¢è¯•å®˜çœ‹ï¼Œé‚£ä¹ˆè¿™äº›éƒ½æ˜¯æ€ä¹ˆå® ç°çš„å‘¢ï¼Ÿ

é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡è¿™ç¯‡æ–‡ç« æ¥å­¦ä¹ ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªæµè§ˆå™¨å½•å±çš„åŠŸèƒ½ã€‚

# navigator.mediaDevices

mediaDevices æ˜¯ Navigator åªè¯»å±æ€§ï¼Œè¿”å›ä¸€ä¸ª MediaDevices å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯æä¾›å¯¹ç›¸æœºå’Œéº¦å…‹é£ç­‰åª’ä½“è¾“å…¥è®¾å¤‡çš„è¿æ¥è®¿é—®ï¼Œä¹ŸåŒ…æ‹¬å±å¹•å…±äº«ã€‚

```
const media = navigator.mediaDevices;
```

é€šè¿‡åŸå‹é“¾å¯ä»¥æŸ¥æ‰¾åˆ°ä¸€äº›æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![1710057632600](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1710057632600.png)20230919062009

å…¶ä¸­ getDisplayMedia æ–¹æ³•æ¥è·å–ç”¨æˆ·çš„å±å¹•åˆ†äº«æˆ–å±å¹•æ•è·æµï¼Œé€šå¸¸ç”¨äºåˆ¶ä½œå±å¹•å½•åƒæˆ–è§†é¢‘ä¼šè®®ç­‰åº”ç”¨ã€‚

```js
navigator.mediaDevices.getDisplayMedia({
  video: true,
});
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œè¯·æ±‚è·å–åŒ…å«è§†é¢‘æµçš„åª’ä½“è®¸å¯ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨åä¸º stream çš„å˜é‡ä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚è¿™ä¸ªæµå¯ä»¥ç”¨äºåœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºå±å¹•å…±äº«æˆ–è¿›è¡Œå…¶ä»–åª’ä½“å¤„ç†æ“ä½œã€‚

åˆå› ä¸ºè¯¥æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæˆ‘ä»¬è¦ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š

```js
<body>
  <button>å…±äº«å±å¹•</button>
  <script>
    const button = document.querySelector("button");
    button.addEventListener("click", async () => {
      const stream = await navigator.mediaDevices.getDisplayMedia({
        video: true,
      });
    });
  </script>
</body>
```

é€šè¿‡ç‚¹å‡» button æŒ‰é’®åä¼šå¦‚ä¸‹å›¾æ‰€ç¤ºæ•ˆæœï¼š

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)![1710057678498](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1710057678498.png)

è¿™ä¸ªæ—¶å€™ stream æµæˆ‘ä»¬æ˜¯æ‹¿åˆ°äº†ã€‚

# MediaRecorder

MediaRecorder æ˜¯ä¸€ä¸ª Web APIï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œåª’ä½“å½•åˆ¶ï¼Œä¸»è¦ç”¨äºå½•åˆ¶éŸ³é¢‘å’Œè§†é¢‘ã€‚å®ƒå…è®¸ä½ ä»ä¸åŒçš„æ¥æºï¼Œä¾‹å¦‚éº¦å…‹é£ã€æ‘„åƒå¤´ã€å±å¹•å…±äº«æˆ–å…¶ä»–åª’ä½“å…ƒç´ ï¼Œæ•è·éŸ³é¢‘å’Œè§†é¢‘æ•°æ®ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸ºæ–‡ä»¶æˆ–è¿›è¡Œå®æ—¶æµåª’ä½“ä¼ è¾“ã€‚

é€šè¿‡è°ƒç”¨ MediaRecorder.isTypeSupported() æ–¹æ³•ä¼šåˆ¤æ–­å…¶ MIME æ ¼å¼èƒ½å¦è¢«å®¢æˆ·ç«¯å½•åˆ¶ã€‚å®ƒæ”¯æŒçš„ç±»å‹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

```
const types = [
  "video/webm",
  "audio/webm",
  "video/webm;codecs=vp8",
  "video/webm;codecs=daala",
  "video/webm;codecs=h264",
  "audio/webm;codecs=opus",
  "video/mpeg",
];
```

é€šè¿‡è¿™ç§æ–¹å¼æ¥æŸ¥çœ‹å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯¥ç±»å‹,å¦‚ä¸‹ä»£ç æ‰€ç¤º:

```
const mime = MediaRecorder.isTypeSupported("video/webm;codecs=h264")
  ? "video/webm;codecs=h264"
  : "video/webm";
```

ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º:

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)![1710057708255](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1710057708255.png)

```
const mediaRecorder = new MediaRecorder(stream, { mimeType: mime });
```

åœ¨è¿™æ®µä»£ç é‡Œé¢,æ‰§è¡Œ new å…³é”®å­—å®ä¾‹åŒ– MediaRecorder å¯¹è±¡ã€‚è¯¥å¯¹è±¡çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)![1710057729489](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1710057729489.png)

æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›‘å¬å®ƒçš„äº‹ä»¶æ¥è¿›è¡Œä¸åŒçš„æ“ä½œ,å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```js
const chunks = [];
mediaRecorder.addEventListener("dataavailable", function (e) {
  chunks.push(e.data);
});

mediaRecorder.addEventListener("stop", () => {
  const blob = new Blob(chunks, { type: chunks[0].type });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "video.webm";
  a.click();
});
```

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹æ®µä»£ç çš„è¯¦ç»†æ­¥éª¤:

1. dataavailable äº‹ä»¶çš„ç›‘å¬å™¨ã€‚å½“ MediaRecorder æœ‰å¯ç”¨çš„éŸ³é¢‘/è§†é¢‘æ•°æ®å—æ—¶ï¼Œå®ƒä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæ¯å½“æ•°æ®å¯ç”¨æ—¶ï¼Œå°†æ•°æ®å—ï¼ˆe.dataï¼‰æ·»åŠ åˆ° chunks æ•°ç»„ä¸­ã€‚è¿™æ˜¯ä¸ºäº†åœ¨å½•åˆ¶å®Œæˆåå°†è¿™äº›æ•°æ®å—åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„åª’ä½“æ–‡ä»¶ã€‚
2. stop äº‹ä»¶çš„ç›‘å¬å™¨ã€‚å½“å½•åˆ¶åœæ­¢æ—¶ï¼ŒMediaRecorder ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚
3. const blob = new Blob(chunks, { type: chunks[0].type });ï¼šä½¿ç”¨ Blob æ„é€ å‡½æ•°å°† chunks æ•°ç»„ä¸­çš„æ•°æ®å—åˆå¹¶æˆä¸€ä¸ªäºŒè¿›åˆ¶å¯¹è±¡ï¼ˆBlob å¯¹è±¡ï¼‰ã€‚chunks[0].type ç”¨äºæŒ‡å®š Blob çš„åª’ä½“ç±»å‹ï¼Œé€šå¸¸æ˜¯ WebMã€‚
4. const url = URL.createObjectURL(blob);ï¼šä½¿ç”¨ URL.createObjectURL æ–¹æ³•å°† Blob å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªä¸´æ—¶ URLã€‚è¿™ä¸ª URL å¯ä»¥ç”¨äºåˆ›å»ºä¸‹è½½é“¾æ¥ã€‚é€šè¿‡è¿™ä¸ª url ä¼ é€’ç»™æ–°åˆ›å»ºçš„ a å…ƒç´ ç”¨äºä¸‹è½½åŠŸèƒ½ã€‚
5. a.click() é€šè¿‡æ¨¡æ‹Ÿç‚¹å‡»è¶…é“¾æ¥æ¥è§¦å‘ä¸‹è½½æ“ä½œã€‚ç”¨æˆ·å°†çœ‹åˆ°ä¸€ä¸ªä¸‹è½½å¯¹è¯æ¡†ï¼Œå…è®¸ä»–ä»¬ä¿å­˜å½•åˆ¶çš„åª’ä½“æ–‡ä»¶

è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªå±å¹•å½•åˆ¶åŠŸèƒ½äº†ï¼Œå¹¶ä¸”é€šè¿‡è¯¥æ–¹æ³•å®ç°äº†ä¸€ä¸ªéŸ³è§†é¢‘ä¸‹è½½çš„åŠŸèƒ½ã€‚

# å®Œæ•´ä»£ç 

è¯¥åŠŸèƒ½çš„å®Œæ•´ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button>å…±äº«å±å¹•</button>
    <script>
      const button = document.querySelector("button");
      button.addEventListener("click", async () => {
        const stream = await navigator.mediaDevices.getDisplayMedia({
          video: true,
        });

        const mime = MediaRecorder.isTypeSupported("video/webm;codecs=h264")
          ? "video/webm;codecs=h264"
          : "video/webm";

        const mediaRecorder = new MediaRecorder(stream, { mimeType: mime });

        const chunks = [];
        mediaRecorder.addEventListener("dataavailable", function (e) {
          chunks.push(e.data);
        });

        mediaRecorder.addEventListener("stop", () => {
          const blob = new Blob(chunks, { type: chunks[0].type });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "video.webm";
          a.click();
        });
        mediaRecorder.start();
      });
    </script>
  </body>
</html>
```

ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å…¶ä»–ä»»ä½•ä¸€ä¸ªé¡µé¢ï¼Œå°† js ä»£ç ä¿®æ”¹ä¸€ä¸‹,ç„¶åç›´æ¥å¤åˆ¶ç²˜è´´åˆ°æ§åˆ¶å°ä¸Šï¼Œå¹¶ç‚¹å‡»é¡µé¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
-const button = document.querySelector("button");
-button.addEventListener("click", async () => {

+const body = document.body;
+body.addEventListener("click", async () => {
```

ç´§æ¥ç€å°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°æµè§ˆå™¨æ§åˆ¶å°ä¸Šé¢ï¼Œå¹¶ç‚¹å‡»é¡µé¢çš„ç©ºç™½å¤„ï¼š

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)![1710057794580](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1710057794580.png)

![1710057813282](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1710057813282.png)

é€šè¿‡è¿™ç§æ–¹å¼å°±å®ç°äº†ä¸€ç§å±å¹•å½•åˆ¶æˆ–è€…å±å¹•åˆ†äº«çš„åŠŸèƒ½äº†ã€‚

æœ€ååˆ†äº«ä¸¤ä¸ªæˆ‘çš„ä¸¤ä¸ªå¼€æºé¡¹ç›®,å®ƒä»¬åˆ†åˆ«æ˜¯:

- **å‰ç«¯è„šæ‰‹æ¶ create-neat**[1]
- **åœ¨çº¿ä»£ç ååŒç¼–è¾‘å™¨**[2]

è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½ä¼šä¸€ç›´ç»´æŠ¤çš„,å¦‚æœä½ ä¹Ÿå–œæ¬¢,æ¬¢è¿ star ğŸ¥°ğŸ¥°ğŸ¥°



åŸæ–‡é“¾æ¥ï¼šhttps://juejin.cn/post/7280057907055869992



